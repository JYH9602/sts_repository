<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>CEW 대시보드</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/gh/joungkyun/font-d2coding/d2coding.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  <style>
    body { margin:0; font-family:'D2Coding', monospace; background:#000; color:#ddd; overflow-y:scroll; }

    /* 🚀 빨간 레이저 느낌 스크롤바 */
    ::-webkit-scrollbar { width: 10px; }
    ::-webkit-scrollbar-track { background: #111; }
    ::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #ff0000, #990000);
      border-radius: 5px;
      box-shadow: 0 0 10px #ff0000, 0 0 20px #ff3333;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, #ff3333, #cc0000);
      box-shadow: 0 0 15px #ff0000, 0 0 30px #ff3333;
    }

    .sidebar { position:fixed; top:0; left:0; width:240px; height:100%; background:#000; color:#fff;
      padding:20px 10px; border-right:1px solid #333; overflow-y:auto; }
    .logo-wrapper { text-align:center; margin-bottom:30px; cursor:pointer; }
    .logo-wrapper img { width:140px; }
    .menu { list-style:none; padding:0; margin:0; }
    .menu > li { margin:8px 0; font-size:16px; color:#fff; cursor:pointer; transition:0.3s; }
    .menu > li:hover { color:#ff0000; }
    .toggle { float:right; display:inline-block; width:22px; height:22px; border-radius:50%;
      background:#111; color:#ff0000; font-weight:bold; font-size:14px; text-align:center; line-height:22px;
      margin-left:5px; box-shadow: 0 0 5px #ff0000, 0 0 10px #ff3333; }
    .submenu { list-style:none; padding-left:20px; margin:5px 0; display:none; }
    .submenu li { font-size:14px; margin:4px 0; cursor:pointer; color:#bbb; }
    .submenu li:hover { color:#ff0000; }
    .content { margin-left:260px; padding:80px 20px 20px 20px; }
    .header { background:#000; color:#fff; padding:10px 20px; display:flex;
      justify-content:flex-end; align-items:center; border-bottom:1px solid #333; gap:15px;
      position:fixed; top:0; left:240px; right:0; z-index:1000; }
    #timer, #loginUser { color:#ffff00; }
    #userRole { color:#ffff00; text-shadow:0 0 5px #ffff00, 0 0 10px #ffea00; }
    .btn-danger { background:#ff0000; border:none; }

    /* 공통 박스 */
    .box { border:none; background:#111; padding:10px; color:#ddd; }
    table { width:100%; font-size:12px; border-collapse:collapse; color:#ddd; }
    th,td { border-bottom:1px solid #444; padding:3px; text-align:center; }

    /* 롤링 */
    .rolling-box { border:1px solid #fff; height:30px; overflow:hidden;
      margin:5px 0; font-size:13px; padding:2px 5px; background:#111; }
    .rolling-text { display:flex; flex-direction:column; animation:rollUp 8s linear infinite; }
    @keyframes rollUp { 0%{transform:translateY(0);} 100%{transform:translateY(-100%);} }

    /* 분석 페이지 */
    .dashboard { display:grid; grid-template-rows:60px auto 1fr; grid-gap:8px; min-height:800px; padding:8px; }
    .top-filter { background:#111; border-radius:8px; padding:8px; }
    .charts { display:grid; grid-template-columns:1fr 1fr; grid-gap:8px; align-items:stretch; }
    .tables { display:grid; grid-template-columns:1fr 1fr; grid-gap:8px; }
    .card { background:#111; border:none; border-radius:8px; padding:8px; color:#ddd; }
    .card canvas { width:100% !important; height:auto !important; max-height:none !important; }
    .btn-dark-custom { background:#222; border:none; color:#fff; padding:4px 10px; border-radius:5px; font-size:13px; }
    .btn-dark-custom:hover { background:#444; }
    .table-dark { --bs-table-bg:#161b22; --bs-table-striped-bg:#1c2128; --bs-table-hover-bg:#21262d;
      color:#ddd; font-size:14px; }
    .table-wrapper { max-height:200px; overflow-y:auto; }
    h5 { font-size:14px; margin-bottom:6px; }
    .circle { width:15px; height:15px; border-radius:50%; display:inline-block; margin:0 3px; }
    .green { background:green; } .yellow{background:yellow;} .red{background:red;} .gray{background:gray;}
    .battery { width:100px; height:25px; border:2px solid #fff; position:relative; margin:auto; }
    .battery::after { content:""; position:absolute; right:-6px; top:5px; width:4px; height:15px; background:#fff; }
    .battery-level { height:100%; width:70%; background:limegreen; }
    
    .packet-box {
  		background:#111;
  		color:#0f0;
 		 padding:10px;
 		 font-size:13px;
 		 white-space:pre;
  		border-radius:5px;
  		display:none;
}
	.badge-lg {
  		font-size: 14px;     /* 글자 크기 */
  		padding: 6px 12px;   /* 위아래, 좌우 여백 */
  		border-radius: 6px;  /* 둥글게 */
}

/* 로그아웃된 행 회색 처리 */
	.logged-out {
  		background-color: #444 !important;
  		color: #aaa !important;
}
	.logged-out td, 
	.logged-out th {
  		color: #aaa !important;
}
.card h5 {
  font-size:14px;
  margin-bottom:6px;
}

#riskChart {
  max-height:300px;   /* 원형 차트 너무 크지 않게 */
}

#accountTokens .badge {
  font-size: 14px;
  background-color: #0dcaf0;
  color: #000;
  cursor: pointer;
}
#accountDetailBox {
  background:#111;
  border:1px solid #555;
  padding:10px;
  border-radius:8px;
  white-space:pre-line;
}

.password-setting-box {
  max-width: 400px;
  margin-left: 0;   /* 본문 영역의 왼쪽 정렬 */
  margin-top: 20px; /* 약간 아래로 */
}

.menu li.active,
.submenu li.active {
  border: 1px solid #ff4d4d;       /* 연한 빨간색 테두리 */
  border-radius: 6px;
  padding: 3px 6px;
  background: rgba(255, 0, 0, 0.15); /* 옅은 빨간 배경 */
  color: #ff4d4d;                  /* 글자색도 강조 */
  font-weight: bold;               /* 글자 두껍게 */
}

  </style>
</head>
<body>
  <!-- 사이드바 -->
  <div class="sidebar">
    <div class="logo-wrapper" onclick="loadContent('보안 이벤트 요약')">
      <img src="/images/logo.png" alt="보안 로고" class="logo" id="eagleLogo">
    </div>
    <ul class="menu">
      <li class="has-sub">
        <span class="menu-title">대시보드</span><span class="toggle">+</span>
        <ul class="submenu">
          <li onclick="loadContent('보안 이벤트 요약')">보안 이벤트 요약</li>
          <li onclick="loadContent('보안 이벤트 분석')">보안 이벤트 분석</li>
          <li onclick="loadContent('리소스 사용현황')">리소스 사용현황</li>
        </ul>
      </li>
      <li class="has-sub"><span class="menu-title">정책관리</span><span class="toggle">+</span>
        <ul class="submenu"><li onclick="loadContent('정책 관리 페이지')">정책 관리 페이지</li></ul>
      </li>
      <li class="has-sub"><span class="menu-title">로그센터</span><span class="toggle">+</span>
        <ul class="submenu">
          <li onclick="loadContent('탐지 로그')">탐지 로그</li>
          <li onclick="loadContent('알림 로그')">알림 로그</li>
          <li onclick="loadContent('차단 이력 로그')">차단 이력 로그</li>
          <li onclick="loadContent('관리자 활동 로그')">관리자 활동 로그</li>
        </ul>
      </li>
      <li class="has-sub"><span class="menu-title">DB 관리서버</span><span class="toggle">+</span>
        <ul class="submenu">
          <li onclick="loadContent('백업 & 복구')">백업 & 복구</li>
          <li onclick="loadContent('보호대상 DB 관리')">보호대상 DB 관리</li>
        </ul>
      </li>
      <li class="has-sub"><span class="menu-title">관리자 페이지</span><span class="toggle">+</span>
        <ul class="submenu">
          <li onclick="loadContent('관리자 계정 관리')">관리자 계정 관리</li>
          <li onclick="loadContent('사용자 권한 관리')">사용자 권한 관리</li>
          <li onclick="loadContent('시스템 정책 설정')">시스템 정책 설정</li>
          <li onclick="loadContent('정책 삭제 암호 설정')">정책 삭제 암호 설정</li>
        </ul>
      </li>
      <li onclick="loadContent('시스템 환경 설정')">시스템 환경 설정</li>
    </ul>
  </div>

<!-- 헤더 -->
<div class="header">
  <span>로그인 경과시간: <strong id="timer">00:00</strong></span>
  <span>로그인 아이디: <strong id="loginUser" th:text="${user.login_id}"></strong></span>
  <span>권한: <strong id="userRole" th:text="${user.position}"></strong></span>
  <button class="btn btn-danger btn-sm" onclick="logout()">로그아웃</button>
</div>

  <!-- 메인 -->
 <div class="content" id="mainContent"></div>


  <!-- 정책 편집 모달 -->
<div class="modal fade" id="policyModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title">정책 편집 (신규)</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        
        <!-- 기본 -->
        <div class="card mb-3 bg-secondary bg-opacity-25 p-3">
          <h6>기본</h6>
          <div class="row g-2">
            <div class="col-md-4"><label class="form-label">rule_id</label><input type="text" class="form-control form-control-sm bg-dark text-white" value="CEW_BLOCK01"></div>
            <div class="col-md-4"><label class="form-label">rule_name</label><input type="text" class="form-control form-control-sm bg-dark text-white" value="도둑잡기"></div>
            <div class="col-md-2"><label class="form-label">priority</label><input type="number" class="form-control form-control-sm bg-dark text-white" value="1"></div>
            <div class="col-md-2"><label class="form-label">action</label>
              <select class="form-select form-select-sm bg-dark text-white"><option>block</option><option>pass</option></select>
            </div>
            <div class="col-md-3"><label class="form-label">level</label>
              <select class="form-select form-select-sm bg-dark text-white"><option>safe</option><option>danger</option></select>
            </div>
            <div class="col-md-3"><label class="form-label">rule_type</label>
              <select class="form-select form-select-sm bg-dark text-white"><option>pattern</option><option>behavior</option></select>
            </div>
          </div>
        </div>

        <!-- 대상 / 조건 -->
        <div class="card mb-3 bg-secondary bg-opacity-25 p-3">
          <h6>대상 / 조건</h6>
          <div class="row g-2">
            <div class="col-md-3"><label class="form-label">ip_start</label><input type="text" class="form-control form-control-sm bg-dark text-white" value="192.168.1.10"></div>
            <div class="col-md-3"><label class="form-label">ip_end</label><input type="text" class="form-control form-control-sm bg-dark text-white" value="192.168.1.20"></div>
            <div class="col-md-3"><label class="form-label">port_start</label><input type="number" class="form-control form-control-sm bg-dark text-white" value="22"></div>
            <div class="col-md-3"><label class="form-label">port_end</label><input type="number" class="form-control form-control-sm bg-dark text-white" value="30"></div>
            <div class="col-md-4"><label class="form-label">block_duration (sec)</label><input type="number" class="form-control form-control-sm bg-dark text-white" value="0"></div>
            <div class="col-md-4"><label class="form-label">base_cnt</label><input type="number" class="form-control form-control-sm bg-dark text-white" value="0"></div>
          </div>
        </div>

        <!-- 스케줄 -->
        <div class="card mb-3 bg-secondary bg-opacity-25 p-3">
          <h6>스케줄</h6>
          <div class="row g-2">
            <div class="col-md-4"><label class="form-label">effective_from</label><input type="time" class="form-control form-control-sm bg-dark text-white"></div>
            <div class="col-md-4"><label class="form-label">effective_to</label><input type="time" class="form-control form-control-sm bg-dark text-white"></div>
            <div class="col-md-4"><label class="form-label">expire_dt</label><input type="date" class="form-control form-control-sm bg-dark text-white"></div>
            <div class="col-md-4"><label class="form-label">created_by</label><input type="text" class="form-control form-control-sm bg-dark text-white" value="admin" readonly></div>
            <div class="col-md-4"><label class="form-label">updated_by</label><input type="text" class="form-control form-control-sm bg-dark text-white" value="admin" readonly></div>
          </div>
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">닫기</button>
        <button type="button" class="btn btn-primary btn-sm">저장</button>
      </div>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" defer></script>
<!-- 삭제 확인 모달 -->
<div class="modal fade" id="deleteModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title">삭제 확인</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p>정책을 삭제하려면 암호를 입력하세요.</p>
        <input type="password" id="deletePassword" class="form-control form-control-sm bg-dark text-white" placeholder="삭제 암호 입력">
        <div id="deleteError" class="text-danger mt-2" style="display:none;">암호가 올바르지 않습니다.</div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal">취소</button>
        <button class="btn btn-danger btn-sm" onclick="confirmDelete()">삭제</button>
      </div>
    </div>
  </div>
</div>
<!-- 삭제된 항목 보기 모달 -->
<div class="modal fade" id="deletedListModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title">삭제된 정책 목록</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <table class="table table-dark table-striped text-center">
          <thead>
            <tr>
              <th>rule_id</th>
              <th>rule_name</th>
              <th>level</th>
              <th>rule_type</th>
              <th>action</th>
            </tr>
          </thead>
          <tbody id="deletedPolicyList">
            <tr><td colspan="5">삭제된 항목이 없습니다.</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- 탐지로그 상세 모달 -->
<div class="modal fade" id="logDetailModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title">상세 정보</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <h6>요약 정보</h6>
        <ul>
          <li>시간: 2025-09-16 10:00</li>
          <li>정책명: SQL Injection</li>
          <li>위험도: <span class="badge bg-danger">High</span></li>
          <li>탐지 유형: Web Attack</li>
          <li>출발지 IP: 192.168.1.10</li>
          <li>목적지 IP: 10.0.0.5</li>
        </ul>

        <h6 class="mt-3">패킷 해석 내용</h6>
        <p><strong>HTTP 요청:</strong> GET /login.php?id=1' OR '1'='1 HTTP/1.1</p>
        <p><strong>Host:</strong> victim.com</p>
        <p><strong>User-Agent:</strong> Mozilla/5.0 …</p>

        <button class="btn btn-secondary btn-sm mt-2" onclick="togglePacket()">원본 패킷 보기</button>
        <div id="packetBox" class="packet-box mt-2">
4500 003c 1c46 4000 4006 b1e6 c0a8 0001
c0a8 0067 0050 89ab 1190 0000 0000 0000
5018 ffff aaaa bbbb 4745 5420 2f6c 6f67
696e 2e70 6870 3f69 643d 3127 204f 5220
3127 3d31 2048 5454 502f 312e 31
        </div>
      </div>
    </div>
  </div>
</div>
<!-- 알림로그 상세 모달 -->
<div class="modal fade" id="alertLogModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title">알림 로그 상세</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <h6>요약 정보</h6>
        <ul>
          <li>알림 시각: 2025-09-16 09:50</li>
          <li>알림 대상자: admin01 (admin@test.com)</li>
          <li>알림 방식: Email</li>
          <li>알림 등급: 긴급</li>
          <li>관련 탐지 이벤트 ID: DET-00123</li>
          <li>알림 내용: 고위험 SQL Injection 탐지됨</li>
          <li>발송 상태: 성공</li>
        </ul>

        <button class="btn btn-secondary btn-sm mt-2" onclick="togglePacket()">원본 패킷 보기</button>
        <div id="packetBox" class="packet-box mt-2">
알림 로그는 패킷 데이터가 없을 수도 있습니다.
        </div>
      </div>
    </div>
  </div>
</div>
<!-- 차단 이력 로그 상세 모달 -->
<div class="modal fade" id="blockLogModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title">차단 이력 로그 상세</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <h6>요약 정보</h6>
        <ul>
          <li>차단 시각: 2025-09-15 14:30</li>
          <li>정책명/룰 ID: Port Scan Rule #12</li>
          <li>차단 대상: 203.0.113.77</li>
          <li>출발지: 203.0.113.77:55555</li>
          <li>목적지: 10.0.0.7:22</li>
          <li>차단 사유: 비인가 포트 접근</li>
          <li>차단 결과: <span class="badge bg-success badge-lg">성공</span></li>
          <li>차단 지속시간: 10분</li>
        </ul>
      </div>
    </div>
  </div>
</div>
<!-- 공통 알림 모달 -->
<div class="modal fade" id="alertModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title">알림</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="alertMessage">메시지 내용</div>
      <div class="modal-footer">
        <button class="btn btn-primary btn-sm" data-bs-dismiss="modal">확인</button>
      </div>
    </div>
  </div>
</div>
<!-- 공통 확인 모달 -->
<div class="modal fade" id="confirmModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title">확인</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="confirmMessage">메시지 내용</div>
      <div class="modal-footer">
        <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal">취소</button>
        <button id="confirmOkBtn" class="btn btn-primary btn-sm">확인</button>
      </div>
    </div>
  </div>
</div>

<!-- 비밀번호 변경 모달 -->
<div class="modal fade" id="changePasswordModal" tabindex="-1">
  <div class="modal-dialog modal-sm modal-dialog-centered">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title">비밀번호 변경</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="changePwForm">
          <div class="mb-2">
            <label class="form-label">현재 비밀번호</label>
            <input type="password" name="current_password" class="form-control form-control-sm bg-dark text-white">
          </div>
          <div class="mb-2">
            <label class="form-label">새 비밀번호</label>
            <input type="password" name="new_password" class="form-control form-control-sm bg-dark text-white">
          </div>
          <div class="mb-2">
            <label class="form-label">새 비밀번호 확인</label>
            <input type="password" name="new_password_confirm" class="form-control form-control-sm bg-dark text-white">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal">취소</button>
        <button class="btn btn-success btn-sm" id="savePwChange">저장</button>
      </div>
    </div>
  </div>
</div>



<script>
  // 메뉴 토글
  document.querySelectorAll(".has-sub").forEach(menu=>{
    const toggle=menu.querySelector(".toggle");
    const title=menu.querySelector(".menu-title");
    const submenu=menu.querySelector(".submenu");
    function toggleMenu(e){ e.stopPropagation();
      submenu.style.display=(submenu.style.display==="block")?"none":"block";
      toggle.textContent=(submenu.style.display==="block")?"-":"+"; }
    toggle.addEventListener("click",toggleMenu);
    title.addEventListener("click",toggleMenu);
  });
  let rowToDelete = null;  // 전역 변수
  let deletedPolicies = []; // 삭제된 정책들을 보관

  function openDeleteModal(btn) {
    rowToDelete = btn.closest("tr");
    const modal = new bootstrap.Modal(document.getElementById("deleteModal"));
    modal.show();
  }

  function loadContent(title) {
    const content = document.getElementById("mainContent");
    // ✅ 모든 메뉴 active 해제
    document.querySelectorAll(".menu li, .submenu li").forEach(li => {
      li.classList.remove("active");
    });

    // ✅ 방금 클릭한 메뉴에 active 부여
    const menus = document.querySelectorAll(".menu li, .submenu li");
    menus.forEach(li => {
      if (li.innerText.trim() === title) {
        li.classList.add("active");
      }
    });
    // --- 보안 이벤트 요약 ---
    if(title==="보안 이벤트 요약"){
      content.innerHTML=`
        <h2>보안 이벤트 요약</h2>
        <div>실시간 탐지 내용:</div>
        <div class="rolling-box"><div class="rolling-text">
          <span>[탐지] SQL Injection 차단됨</span>
          <span>[탐지] XSS 공격 탐지됨</span>
          <span>[탐지] Port Scan 발생</span>
          <span>[탐지] RDP Brute Force 차단</span>
        </div></div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:15px;">
          <div class="box"><canvas id="chart1"></canvas></div>
          <div class="box"><canvas id="chart2"></canvas></div>
        </div>
        <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-top:15px;">
          <div class="box">일일 탐지 순위 (정책기반)</div>
          <div class="box"><canvas id="chart3"></canvas></div>
          <div class="box">일일 누적 탐지 패킷수</div>
        </div>
        <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-top:15px;">
          <div class="box">서버상태<br>
            <span class="circle green"></span>
            <span class="circle yellow"></span>
            <span class="circle red"></span>
            <span class="circle gray"></span>
          </div>
          <div class="box">리소스 사용량<br>
            <div class="battery"><div class="battery-level"></div></div>
          </div>
          <div class="box">방화벽 상태<br><strong style="color:lime;">ON</strong></div>
          <div class="box">열려 있는 포트
            <table><tr><th>포트</th><th>상태</th></tr>
              <tr><td>22</td><td>Open</td></tr>
              <tr><td>80</td><td>Open</td></tr>
              <tr><td>443</td><td>Open</td></tr>
            </table>
          </div>
          <div class="box">최근접속로그
            <table><tr><th>시간</th><th>IP</th></tr>
              <tr><td>12:00</td><td>192.168.0.10</td></tr>
              <tr><td>12:05</td><td>192.168.0.11</td></tr>
            </table>
          </div>
          <div class="box">일일 이메일 알림현황
            <ul>
              <li>관리자 알림 전송 완료</li>
              <li>정책 알림 대기</li>
              <li>서버상태 알림 완료</li>
            </ul>
          </div>
        </div>`;
      new Chart(document.getElementById('chart1'),{type:'line',
        data:{labels:["0시","4시","8시","12시","16시","20시"],
          datasets:[{label:"행동기반",data:[5,7,3,8,6,9],borderColor:"red",fill:false},
                    {label:"패턴기반",data:[3,4,6,2,7,5],borderColor:"blue",fill:false}]}}); 
      new Chart(document.getElementById('chart2'),{type:'bar',
        data:{labels:["정책A","정책B","정책C"],
          datasets:[{label:"탐지 건수",data:[12,19,7],backgroundColor:["red","orange","green"]}]}}); 
      new Chart(document.getElementById('chart3'),{type:'pie',
        data:{labels:["Critical","High","Medium","Low"],
          datasets:[{data:[5,10,15,20],backgroundColor:["red","orange","yellow","green"]}]}}); 
    }

    // --- 보안 이벤트 분석 ---
else if(title==="보안 이벤트 분석"){
  content.innerHTML=`
    <div class="dashboard">
      
      <!-- 상단 필터 -->
      <div class="top-filter mb-2">
        <div class="row g-2">
          <div class="col-md-2">
            <select class="form-select bg-dark text-white form-select-sm">
              <option>행동기반</option><option>패턴기반</option><option>정책기반</option>
            </select>
          </div>
          <div class="col-md-3"><input type="date" class="form-control bg-dark text-white form-control-sm"></div>
          <div class="col-md-3"><input type="time" class="form-control bg-dark text-white form-control-sm"></div>
          <div class="col-md-2 ms-auto text-end">
            <button class="btn-dark-custom btn-sm me-2">적용</button>
            <button class="btn-dark-custom btn-sm">초기화</button>
          </div>
        </div>
      </div>

      <!-- 메인 레이아웃 -->
      <div class="row">
        <!-- 왼쪽 영역 (시간대별 탐지 + TOP10 세로배치) -->
        <div class="col-md-8 d-flex flex-column gap-2">
          <div class="card flex-fill"><h5>시간대별 탐지</h5><canvas id="timeChart"></canvas></div>
          <div class="card flex-fill"><h5>탐지 TOP 10</h5><canvas id="top10Chart"></canvas></div>
        </div>

        <!-- 오른쪽 영역 (위험도 분포) -->
        <div class="col-md-4">
          <div class="card h-100"><h5>위험도 분포</h5><canvas id="riskChart"></canvas></div>
        </div>
      </div>

      <!-- 하단 날짜/시간 설정 -->
      <div class="row mt-3">
      <div class="col-md-12 box text-center">
        날짜 설정 : 
        <input type="date" id="customDate" class="form-control d-inline-block bg-dark text-white form-control-sm" style="width:auto;">
        　
        시간 설정 : 
        <input type="time" id="customTime" class="form-control d-inline-block bg-dark text-white form-control-sm" style="width:auto;">
        
        <button class="btn-dark-custom btn-sm ms-2" onclick="applyDateTime()">적용</button>
      </div>
    </div>
          <div class="tables">
            <div class="card"><h5>시간대별 탐지 로그</h5>
              <div class="table-wrapper">
                <table class="table table-dark table-striped">
                  <thead><tr><th>시간</th><th>정책</th><th>위험도</th><th>출발지</th><th>조치</th></tr></thead>
                  <tbody>
                    <tr><td>2025-09-13 11:50</td><td>SQL Injection</td><td>Critical</td><td>203.0.113.10</td><td>차단</td></tr>
                    <tr><td>2025-09-13 11:45</td><td>Brute Force</td><td>High</td><td>198.51.100.5</td><td>차단</td></tr>
                    <tr><td>2025-09-13 11:40</td><td>Port Scan</td><td>Medium</td><td>192.168.1.100</td><td>탐지만</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="card"><h5>위험도 분포 (목록)</h5>
              <div class="table-wrapper">
                <table class="table table-dark">
                  <thead><tr><th>위험도</th><th>건수</th></tr></thead>
                  <tbody>
                    <tr><td>Critical</td><td>11</td></tr>
                    <tr><td>High</td><td>71</td></tr>
                    <tr><td>Medium</td><td>87</td></tr>
                    <tr><td>Low</td><td>101</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>`;
  // ===== 차트들 =====
  new Chart(document.getElementById('timeChart'), {
    type:'line',
    data:{
      labels:['00시','03시','06시','09시','12시'],
      datasets:[{label:'탐지 건수',data:[3,7,5,12,9],borderColor:'red',fill:false}]
    }
  });
  
  new Chart(document.getElementById('top10Chart'), {
    type:'bar',
    data:{
      labels:['SQL Injection','Brute Force','Critical','Port Scan'],
      datasets:[{label:'탐지 건수',data:[20,15,8,5],backgroundColor:['#ff4d4d','#ff9933','#3399ff','#ffcc00']}]
    }
  });

  new Chart(document.getElementById('riskChart'), {
    type:'doughnut',
    data:{
      labels:['Critical','High','Medium','Low'],
      datasets:[{data:[11,71,87,101],backgroundColor:['#ff4d4d','#ff9933','#ffcc00','#27ae60']}]
    }
  });
}

    // --- 리소스 사용현황 ---
    else if(title==="리소스 사용현황"){
      content.innerHTML=`
        <h2>리소스 사용현황</h2>
        <div style="display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-bottom:15px;">
          <div class="box text-center"><h5>CPU</h5><div id="cpuUsage" style="font-size:20px;">0%</div></div>
          <div class="box text-center"><h5>메모리</h5><div id="memoryUsage" style="font-size:20px;">0%</div></div>
          <div class="box text-center"><h5>스토리지</h5><div id="storageUsage" style="font-size:20px;">0%</div></div>
          <div class="box text-center"><h5>네트워크</h5><div id="networkUsage" style="font-size:20px;">0 Mbps</div></div>
        </div>
        <div style="display:grid; grid-template-columns:2fr 1fr; gap:10px; margin-bottom:15px;">
          <div class="box"><h5>리소스 트렌드</h5><canvas id="resourceTrend"></canvas></div>
          <div class="box"><h5>알림 & 상태</h5>
            <ul style="font-size:13px; list-style:none; padding-left:0;">
              <li>09:10 - 스토리지 사용률 80% 근접 (경고)</li>
              <li>04:25 - CPU 스파이크 감지</li>
              <li>어제 22:11 - 네트워크 RX 비정상</li>
            </ul>
            <button class="btn-dark-custom btn-sm mt-2">임계치 초과시 이메일 알림</button>
            <button class="btn-dark-custom btn-sm mt-2">자동 정책 · 스로틀링</button>
          </div>
        </div>
        <div class="box"><h5>상세정보</h5><p>메모리, 스토리지, 네트워크 (향후 개발 예정)</p></div>`;
      new Chart(document.getElementById('resourceTrend'),{type:'line',
        data:{labels:Array.from({length:12},(_,i)=>(i*5)+":00"),
          datasets:[
            {label:"CPU(%)",data:[20,40,35,60,45,70,55,65,40,50,45,60],borderColor:"red",fill:false},
            {label:"메모리(%)",data:[30,35,40,45,50,55,60,62,58,57,59,60],borderColor:"orange",fill:false},
            {label:"네트워크(Mbps)",data:[100,150,120,200,180,220,210,190,170,160,180,200],borderColor:"blue",fill:false},
            {label:"스토리지(%)",data:[50,52,53,54,55,56,57,58,59,60,61,62],borderColor:"green",fill:false}
          ]}}); 
      setInterval(()=>{document.getElementById("cpuUsage").innerText=Math.floor(Math.random()*100)+"%";
        document.getElementById("memoryUsage").innerText=Math.floor(Math.random()*100)+"%";
        document.getElementById("storageUsage").innerText=(40+Math.floor(Math.random()*60))+"%";
        document.getElementById("networkUsage").innerText=(100+Math.floor(Math.random()*900))+" Mbps";},3000);
    }
    // --- 정책 관리 페이지 ---
    else if(title==="정책 관리 페이지"){
      content.innerHTML = `
        <h2>정책 관리</h2>
        <div class="box mb-3">
          <div class="row g-2">
            <div class="col-md-2"><input type="text" class="form-control form-control-sm bg-dark text-white" placeholder="rule_id, rule_name"></div>
            <div class="col-md-1"><select class="form-select form-select-sm bg-dark text-white"><option>전체</option><option>패턴기반</option></select></div>
            <div class="col-md-1"><select class="form-select form-select-sm bg-dark text-white"><option>전체</option><option>pass</option><option>block</option></select></div>
            <div class="col-md-1"><select class="form-select form-select-sm bg-dark text-white"><option>전체</option><option>safe</option><option>danger</option></select></div>
            <div class="col-md-1"><select class="form-select form-select-sm bg-dark text-white"><option>전체</option><option>enable</option><option>disable</option></select></div>
            <div class="col-md-1"><input type="number" class="form-control form-control-sm bg-dark text-white" value="0"></div>
            <div class="col-md-2"><input type="date" class="form-control form-control-sm bg-dark text-white"></div>
            <div class="col-md-2"><input type="date" class="form-control form-control-sm bg-dark text-white"></div>
            <div class="col-md-2">
            <div class="text">
            <button class="btn btn-primary btn-sm">필터 적용</button>
            <button class="btn btn-secondary btn-sm">초기화</button>
          </div>
          </div>
          </div>
        </div>

        <div class="d-flex justify-content-end mb-2 gap-2">
          <button class="btn btn-success btn-sm">CSV 내보내기</button>
          <button class="btn btn-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#deletedListModal">삭제된 항목 보기</button>
          <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#policyModal">신규 정책</button>
        </div>

        <div class="table-wrapper">
          <table class="table table-dark table-striped text-center">
            <thead>
              <tr>
                <th>rule_id</th>
                <th>rule_name</th>
                <th>level</th>
                <th>rule_type</th>
                <th>action</th>
                <th>IP Range</th>
                <th>Port Range</th>
                <th>enable</th>
                <th>priority</th>
                <th>effective</th>
                <th>expire_dt</th>
                <th>작업</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>CEW_PASS01</td>
                <td>내부허용</td>
                <td><span class="badge bg-success badge-lg">safe</span></td>
                <td>pattern</td>
                <td>pass</td>
                <td>10.0.0.1 ~ 10.0.0.255</td>
                <td>80 ~ 80</td>
                <td><input type="checkbox" checked></td>
                <td>5</td>
                <td>00:00 ~ 23:59</td>
                <td>9999-12-30 00:00</td>
                <td>
                  <button class="btn-dark-custom btn-sm">수정</button>
                  <button class="btn-dark-custom btn-sm" onclick="openDeleteModal(this)">삭제</button>
                </td>
              </tr>
              <tr>
                <td>CEW_BLOCK02</td>
                <td>SQL Injection 차단</td>
                <td><span class="badge bg-danger badge-lg">danger</span></td>
                <td>pattern</td>
                <td>block</td>
                <td>*</td>
                <td>*</td>
                <td><input type="checkbox"></td>
                <td>2</td>
                <td>00:00 ~ 23:59</td>
                <td>9999-12-30 00:00</td>
                <td>
                  <button class="btn-dark-custom btn-sm">수정</button>
                  <button class="btn-dark-custom btn-sm" onclick="openDeleteModal(this)">삭제</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      `;
    }
    // ====== 탐지로그 =======
    else if(title === "탐지 로그") {
    	  content.innerHTML = `
    	    <h2>탐지 로그</h2>
    	    <table class="table table-dark table-bordered text-center">
    	      <thead>
    	        <tr>
    	          <th>탐지 시각</th>
    	          <th>정책명/탐지규칙</th>
    	          <th>위험도</th>
    	          <th>탐지 유형</th>
    	          <th>출발지 IP</th>
    	          <th>출발지 Port</th>
    	          <th>목적지 IP</th>
    	          <th>목적지 Port</th>
    	          <th>작업</th>
    	        </tr>
    	      </thead>
    	      <tbody>
    	        <tr>
    	          <td>2025-09-16 10:00</td>
    	          <td>SQL Injection</td>
    	          <td><span class="badge bg-danger badge-lg">High</span></td>
    	          <td>Web Attack</td>
    	          <td>192.168.1.10</td>
    	          <td>12345</td>
    	          <td>10.0.0.5</td>
    	          <td>80</td>
    	          <td>
    	            <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#logDetailModal">
    	              상세
    	            </button>
    	          </td>
    	        </tr>
    	      </tbody>
    	    </table>
    	  `;
    	}
 // ====== 알림 로그 ======
    else if(title === "알림 로그") {
      content.innerHTML = `
        <h2>알림 로그</h2>
        <div class="table-wrapper">
          <table class="table table-dark table-bordered text-center">
            <thead>
              <tr>
                <th>알림 시각</th>
                <th>알림 대상자</th>
                <th>알림 방식</th>
                <th>알림 등급</th>
                <th>관련 탐지 이벤트 ID</th>
                <th>알림 내용</th>
                <th>발송 상태</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>2025-09-16 09:50</td>
                <td>admin01<br>(admin@test.com)</td>
                <td>Email</td>
                <td><span class="badge bg-danger badge-lg">긴급</span></td>
                <td>DET-00123</td>
                <td>고위험 SQL Injection 탐지됨</td>
                <td><span class="badge bg-success badge-lg">성공</span></td>
              </tr>
            </tbody>
          </table>
        </div>
      `;
    }
 // ====== 차단 이력 로그 ======
    else if(title === "차단 이력 로그") {
      content.innerHTML = `
        <h2>차단 이력 로그</h2>
        <div class="table-wrapper">
          <table class="table table-dark table-bordered text-center">
            <thead>
              <tr>
                <th>차단 시각</th>
                <th>정책명/룰 ID</th>
                <th>차단 대상</th>
                <th>출발지 IP</th>
                <th>출발지 Port</th>
                <th>목적지 IP</th>
                <th>목적지 Port</th>
                <th>차단 사유</th>
                <th>차단 결과</th>
                <th>차단 지속시간</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>2025-09-15 14:30</td>
                <td>Port Scan Rule #12</td>
                <td>203.0.113.77</td>
                <td>203.0.113.77</td>
                <td>55555</td>
                <td>10.0.0.7</td>
                <td>22</td>
                <td>비인가 포트 접근</td>
                <td><span class="badge bg-success badge-lg">성공</span></td>
                <td>10분</td>
              </tr>
            </tbody>
          </table>
        </div>
      `;
    }
 // ====== 관리자 활동 로그 ======
    else if(title === "관리자 활동 로그") {
      content.innerHTML = `
        <h2>관리자 활동 로그</h2>
        <div class="table-wrapper">
          <table class="table table-dark table-bordered text-center">
            <thead>
              <tr>
                <th>활동 시각</th>
                <th>관리자 ID</th>
                <th>관리자 계정</th>
                <th>사용페이지</th>
                <th>세부 활동 내용</th>
                <th>접속 IP</th>
                <th>결과 상태</th>
                <th>비고</th>
              </tr>
            </thead>
            <tbody>
            <!-- 정상 활동 -->
            <tr>
              <td>2025-09-15 11:00</td>
              <td>admin01</td>
              <td>관리자 계정 A</td> <!-- 추가 -->
              <td>정책관리</td>
              <td>SQL Injection 차단 정책 수정</td>
              <td>192.168.1.100</td>
              <td><span class="badge bg-success badge-lg">로그인</span></td>
              <td>-</td>
            </tr>

            <!-- 로그아웃된 계정 -->
            <tr class="logged-out">
              <td>2025-09-15 11:05</td>
              <td>admin02</td>
              <td>관리자 계정 B</td> <!-- 추가 -->
              <td>시스템환경설정</td>
              <td>로그아웃</td>
              <td>192.168.1.110</td>
              <td><span class="badge bg-secondary badge-lg">로그오프</span></td>
              <td>-</td>
            </tr>
          </tbody>
          </table>
        </div>
      `;
    }
 // --- 백업 & 복구 ---
    else if (title === "백업 & 복구") {
      content.innerHTML = `
        <h2>DB 백업 & 복구</h2>

        <!-- 백업 설정 -->
        <div class="box mb-3">
          <h5>백업 설정</h5>
          <div class="mb-2">
            <label class="form-label">DB 선택</label>
            <select class="form-select bg-dark text-white form-select-sm" id="dbSelect">
              <option>MySQL</option>
              <option>PostgreSQL</option>
              <option>MariaDB</option>
            </select>
          </div>
          <div class="mb-2">
            <label class="form-label">백업 경로</label>
            <input type="text" id="backupPath" class="form-control bg-dark text-white" value="/backup/db/">
          </div>
          <button class="btn btn-primary btn-sm" onclick="runBackup()">백업 실행</button>
          <div class="progress mt-2" style="height:20px;">
            <div id="backupProgress" class="progress-bar bg-success" role="progressbar" style="width:0%;">0%</div>
          </div>
        </div>

        <!-- 백업 스케줄 설정 -->
        <div class="box mb-3">
          <h5>백업 스케줄 설정</h5>
          <div class="mb-2">
            <input type="radio" name="backupSchedule" value="daily"> 매일
            <input type="radio" name="backupSchedule" value="weekly"> 매주
            <input type="radio" name="backupSchedule" value="monthly"> 매월
          </div>
          <button class="btn btn-secondary btn-sm" onclick="saveSchedule()">저장</button>
          <p id="scheduleStatus" class="mt-2 text-info">백업 스케줄: 미설정</p>
        </div>

        <!-- 복구 실행 -->
        <div class="box">
          <h5>복구 실행</h5>
          <div class="mb-2">
            <label class="form-label">복구 날짜</label>
            <input type="date" id="restoreDate" class="form-control bg-dark text-white">
          </div>
          <button class="btn btn-info btn-sm" onclick="runRestore()">복구</button>
          <div class="mt-2">
            <label class="form-label">DB 선택</label>
            <select class="form-select bg-dark text-white form-select-sm" id="restoreDbSelect">
              <option>MySQL</option>
              <option>PostgreSQL</option>
              <option>MariaDB</option>
            </select>
          </div>
          <div class="mt-2">
            <label class="form-label">복구 경로</label>
            <input type="text" id="restorePath" class="form-control bg-dark text-white" placeholder="/backup/db/yyyy-mm-dd/">
          </div>
        </div>
      `;
    }
 // --- 보호대상 DB 관리 ---
    else if (title === "보호대상 DB 관리") {
      content.innerHTML = `
        <h2>보호대상 DB 관리</h2>
        <div class="d-flex justify-content-end mb-2">
          <button class="btn btn-primary btn-sm" onclick="addDb()">DB 추가</button>
        </div>
        <div class="table-wrapper">
          <table class="table table-dark table-bordered text-center align-middle">
            <thead>
              <tr>
                <th>DB 이름</th>
                <th>IP</th>
                <th>Port</th>
                <th>위험도</th>
                <th>최근 탐지 이벤트</th>
                <th>암호화 적용</th>
                <th>접속 로그</th>
                <th>관리</th>
              </tr>
            </thead>
            <tbody id="dbTableBody">
              <tr>
                <td>CustomerDB</td>
                <td>192.168.0.10</td>
                <td>3306</td>
                <td><span class="badge bg-danger badge-lg">Critical</span></td>
                <td>12건 (경고 7 / 차단 5)</td>
                <td>적용</td>
                <td>최근 24h: 120회 / 차단 5회</td>
                <td>
                <button class="btn-dark-custom btn-sm">수정</button>
                <button class="btn-dark-custom btn-sm" onclick="openDeleteModal(this)">삭제</button>
                </td>
              </tr>
              <tr>
                <td>LogDB</td>
                <td>192.168.0.20</td>
                <td>5432</td>
                <td><span class="badge bg-warning text-dark badge-lg">High</span></td>
                <td>6건 (경고 6 / 차단 0)</td>
                <td>미적용</td>
                <td>최근 24h: 80회 / 차단 0회</td>
                <td>
                <button class="btn-dark-custom btn-sm">수정</button>
                <button class="btn-dark-custom btn-sm" onclick="openDeleteModal(this)">삭제</button>
                </td>
              </tr>
              <tr>
                <td>PaymentDB</td>
                <td>192.168.0.30</td>
                <td>1521</td>
                <td><span class="badge bg-success badge-lg">Low</span></td>
                <td>0건 (경고 0 / 차단 0)</td>
                <td>적용</td>
                <td>최근 24h: 30회 / 차단 0회</td>
                <td>
                <button class="btn-dark-custom btn-sm">수정</button>
                <button class="btn-dark-custom btn-sm" onclick="openDeleteModal(this)">삭제</button>
              </td>
              </tr>
            </tbody>
          </table>
        </div>
      `;
    }
    else if (title === "관리자 계정 관리") {
    	  content.innerHTML = `
    	    <h2>관리자 계정 관리</h2>

    	    <!-- 상단 버튼 -->
    	    <div class="mb-2">
    	      <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addAccountModal">+ 계정 등록</button>
    	      <button class="btn btn-secondary btn-sm" id="editBtn">계정 수정</button>
    	      <button class="btn btn-danger btn-sm" id="deleteBtn">계정 삭제</button>
    	      <button class="btn btn-dark btn-sm" id="toggleStatusCol">상태 숨기기</button>
    	    </div>

    	    <!-- 계정 목록 테이블 -->
    	    <div class="table-wrapper">
    	      <table class="table table-dark table-bordered text-center align-middle" id="accountTable">
    	        <thead>
    	          <tr>
    	            <th>선택</th>
    	            <th>아이디</th>
    	            <th>이름</th>
    	            <th>이메일</th>
    	            <th>전화번호</th>
    	            <th>권한</th>
    	            <th>등록일</th>
    	            <th>수정일</th>
    	            <th>만료일</th>
    	            <th>상태</th>
    	          </tr>
    	        </thead>
    	        <tbody>
    	          <tr>
    	            <td><input type="checkbox"></td>
    	            <td>admin01</td>
    	            <td>최고관리자</td>
    	            <td>admin01@security.com</td>
    	            <td>010-1234-5678</td>
    	            <td>최고관리자</td>
    	            <td>2025-09-01</td>
    	            <td>2025-09-20</td>
    	            <td>2026-09-01</td>
    	            <td><span class="badge bg-success badge-lg status-toggle">활성</span></td>
    	          </tr>
    	          <tr>
    	            <td><input type="checkbox"></td>
    	            <td>admin02</td>
    	            <td>보안담당</td>
    	            <td>admin02@security.com</td>
    	            <td>010-9876-5432</td>
    	            <td>관리자</td>
    	            <td>2025-08-01</td>
    	            <td>2025-08-20</td>
    	            <td>2026-08-01</td>
    	            <td><span class="badge bg-danger badge-lg status-toggle">비활성</span></td>
    	          </tr>
    	        </tbody>
    	      </table>
    	    </div>

    	    <!-- 계정 등록 모달 -->
    	    <div class="modal fade" id="addAccountModal" tabindex="-1">
    	      <div class="modal-dialog modal-lg modal-dialog-centered">
    	        <div class="modal-content bg-dark text-white">
    	          <div class="modal-header">
    	            <h5 class="modal-title">계정 등록</h5>
    	            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
    	          </div>
    	          <div class="modal-body">
    	            <form id="addAccountForm">
    	              <div class="row g-2">
    	                <div class="col-md-4"><label class="form-label">아이디</label><input type="text" name="id" class="form-control form-control-sm bg-dark text-white" required></div>
    	                <div class="col-md-4" id="passwordField">
    	                <label class="form-label">비밀번호</label>
    	                <input type="password" name="password" class="form-control form-control-sm bg-dark text-white">
    	              </div>

    	              <!-- ✅ 비밀번호 확인은 새 줄로 분리 -->
    	              <div class="col-md-4" id="confirmPwField">
    	                <label class="form-label">비밀번호 확인</label>
    	                <input type="password" name="confirm_password" class="form-control form-control-sm bg-dark text-white">
    	              </div>

    	              <!-- 수정 모드 전용 -->
    	              <div class="col-md-4" id="changePwBox" style="display:none;">
    	                <label class="form-label d-block">비밀번호</label>
    	                <button type="button" class="btn btn-warning btn-sm" id="showPwChange">비밀번호 변경</button>
    	              </div>
    	                <div class="col-md-4"><label class="form-label">이름</label><input type="text" name="name" class="form-control form-control-sm bg-dark text-white"></div>
    	                <div class="col-md-6"><label class="form-label">이메일</label><input type="email" name="email" class="form-control form-control-sm bg-dark text-white"></div>
    	                <div class="col-md-6"><label class="form-label">전화번호</label><input type="text" name="phone" class="form-control form-control-sm bg-dark text-white"></div>
    	                <div class="col-md-6"><label class="form-label">권한</label>
    	                  <select name="role" class="form-select form-select-sm bg-dark text-white">
    	                    <option>최고관리자</option>
    	                    <option>관리자</option>
    	                    <option>사용자</option>
    	                  </select>
    	                </div>
    	                <div class="col-md-6"><label class="form-label">상태</label>
    	                  <select name="status" class="form-select form-select-sm bg-dark text-white">
    	                    <option value="활성">활성</option>
    	                    <option value="비활성">비활성</option>
    	                  </select>
    	                </div>
    	                <div class="col-md-6"><label class="form-label">만료일</label><input type="date" name="expire" class="form-control form-control-sm bg-dark text-white"></div>
    	              </div>
    	            </form>
    	          </div>
    	          <div class="modal-footer">
    	            <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal">취소</button>
    	            <button class="btn btn-success btn-sm" onclick="saveAccount()">저장</button>
    	          </div>
    	        </div>
    	      </div>
    	    </div>
    	  `;

    	// 새 계정 저장 기능
    	  window.saveAccount = function() {
    	    const form = document.getElementById("addAccountForm");
    	    const data = Object.fromEntries(new FormData(form).entries());

    	    // 필수값 체크
    	    if (!data.id || !data.password) {
    	      alert("아이디와 비밀번호는 필수입니다!");
    	      return;
    	    }

    	    // ✅ 비밀번호 확인 체크
    	    if (data.password !== data.confirm_password) {
    	      alert("비밀번호가 일치하지 않습니다!");
    	      return;
    	    }

    	    const today = new Date().toISOString().split("T")[0];

    	    // 테이블에 새 행 추가
    	    const tbody = document.querySelector("#accountTable tbody");
    	    const row = document.createElement("tr");
    	    row.innerHTML = `
    	      <td><input type="checkbox"></td>
    	      <td>${data.id}</td>
    	      <td>${data.name || "-"}</td>
    	      <td>${data.email || "-"}</td>
    	      <td>${data.phone || "-"}</td>
    	      <td>${data.role}</td>
    	      <td>${today}</td>
    	      <td>${today}</td>
    	      <td>${data.expire || "-"}</td>
    	      <td><span class="badge ${data.status==="활성" ? "bg-success badge-lg" : "bg-danger badge-lg"}">${data.status}</span></td>
    	    `;
    	    tbody.appendChild(row);

    	    // 모달 닫기
    	    const modal = bootstrap.Modal.getInstance(document.getElementById("addAccountModal"));
    	    modal.hide();

    	    // 초기화
    	    form.reset(); 
    	    document.getElementById("confirmPwField").style.display = "block"; // ✅ 항상 보이도록 초기화
    	  };
    	}
    else if (title === "사용자 권한 관리") {
    	  content.innerHTML = `
    	    <h2>사용자 권한 관리</h2>

    	    <!-- 상단 버튼 -->
    	    <div class="mb-2">
    	      <button class="btn btn-primary btn-sm" id="addRoleBtn">+ 권한 등록</button>
    	      <button class="btn btn-secondary btn-sm" id="editRoleBtn">권한 수정</button>
    	      <button class="btn btn-danger btn-sm" id="deleteRoleBtn">권한 삭제</button>
    	    </div>

    	    <!-- 권한 목록 테이블 -->
    	    <div class="table-wrapper">
    	      <table class="table table-dark table-bordered text-center align-middle" id="roleTable">
    	        <thead>
    	          <tr>
    	            <th>선택</th>
    	            <th>권한명</th>
    	            <th>레벨</th>
    	            <th>설명</th>
    	          </tr>
    	        </thead>
    	        <tbody>
    	          <tr>
    	            <td><input type="checkbox"></td>
    	            <td>최고관리자</td>
    	            <td>1</td>
    	            <td>모든 기능 접근 가능</td>
    	          </tr>
    	          <tr>
    	            <td><input type="checkbox"></td>
    	            <td>중간관리자</td>
    	            <td>2</td>
    	            <td>일부 시스템 설정 불가</td>
    	          </tr>
    	          <tr>
    	            <td><input type="checkbox"></td>
    	            <td>일반관리자</td>
    	            <td>3</td>
    	            <td>로그 조회 및 기본 작업 가능</td>
    	          </tr>
    	        </tbody>
    	      </table>
    	    </div>

    	    <!-- 권한 등록/수정 폼 -->
    	    <div id="roleFormBox" class="box mt-3" style="display:none;">
    	      <h5 id="roleFormTitle">권한 등록</h5>
    	      <form id="roleForm">
    	        <div class="row g-2">
    	          <div class="col-md-4">
    	            <label class="form-label">권한명</label>
    	            <input type="text" name="name" class="form-control form-control-sm bg-dark text-white" required>
    	          </div>
    	          <div class="col-md-2">
    	            <label class="form-label">레벨</label>
    	            <input type="number" name="level" class="form-control form-control-sm bg-dark text-white" required>
    	          </div>
    	          <div class="col-md-6">
    	            <label class="form-label">설명</label>
    	            <input type="text" name="desc" class="form-control form-control-sm bg-dark text-white">
    	          </div>
    	        </div>
    	        <div class="mt-2 text-end">
    	          <button type="button" class="btn btn-secondary btn-sm" onclick="hideRoleForm()">취소</button>
    	          <button type="button" class="btn btn-success btn-sm" onclick="saveRole()">저장</button>
    	        </div>
    	      </form>
    	    </div>
    	  `;
    	}
    
    else if (title === "시스템 정책 설정") {
    	  content.innerHTML = `
    	    <h2>시스템 정책 설정</h2>

    	    <!-- 알림 섹션 -->
    	    <div class="box mb-3">
    	      <h5>알림</h5>
    	      <div class="mb-2">
    	        <label class="form-label">알림 채널</label>
    	        <div>
    	          <label><input type="checkbox" checked> 이메일</label>
    	          <label class="ms-3"><input type="checkbox"> SMS</label>
    	        </div>
    	      </div>

    	      <!-- 계정 선택 -->
    	      <div class="mb-2">
    	        <div id="accountTokens" class="d-flex flex-wrap gap-2 mb-2"></div>
    	        <div class="input-group">
    	          <select id="accountSelect" class="form-select bg-dark text-white form-select-sm">
    	            <option value="">-- 계정 선택 --</option>
    	            <option value="admin01" data-name="홍길동" data-phone="010-0000-0000" data-email="ghdrlfehd@naver.com">admin01</option>
    	            <option value="manager01" data-name="김철수" data-phone="010-1111-2222" data-email="manager@test.com">manager01</option>
    	            <option value="user01" data-name="이영희" data-phone="010-3333-4444" data-email="user@test.com">user01</option>
    	          </select>
    	          <button class="btn btn-primary btn-sm" id="addAccountBtn">추가</button>
    	        </div>
    	      </div>

    	      <!-- 상세 정보 -->
    	      <div id="accountDetailBox" class="box mt-2" style="display:none;">
    	        <p id="detailInfo"></p>
    	        <button class="btn btn-secondary btn-sm" id="closeDetailBtn">취소</button>
    	      </div>

    	      <div class="mt-3">
    	        <label class="form-label">알림 레벨</label>
    	        <select class="form-select bg-dark text-white form-select-sm">
    	          <option>사용자 지정</option>
    	          <option>긴급</option>
    	          <option>중간</option>
    	          <option>낮음</option>
    	        </select>
    	      </div>

    	      <div class="mt-3">
    	        <label class="form-label">임계치 (예: CPU %)</label>
    	        <input type="number" class="form-control form-control-sm bg-dark text-white" value="85">
    	      </div>

    	      <div class="mt-3">
    	        <button class="btn btn-info btn-sm">테스트 이메일</button>
    	        <button class="btn btn-info btn-sm">테스트 SMS</button>
    	      </div>
    	    </div>

    	    <!-- 보안 섹션 -->
    	    <div class="box">
    	      <h5>보안</h5>
    	      <div class="mb-2">
    	        <label><input type="checkbox" checked> 이메일</label>
    	        <label class="ms-3"><input type="checkbox"> SMS</label>
    	      </div>

    	      <div class="mb-2">
    	        <label class="form-label">비밀번호 최소 길이</label>
    	        <input type="number" class="form-control form-control-sm bg-dark text-white" value="8">
    	      </div>
    	      <div class="mb-2">
    	        <label class="form-label">비밀번호 만료일</label>
    	        <input type="number" class="form-control form-control-sm bg-dark text-white" value="90">
    	      </div>
    	      <div class="mb-2">
    	        <label class="form-label">세션 타임아웃 (분)</label>
    	        <input type="number" class="form-control form-control-sm bg-dark text-white" value="30">
    	      </div>

    	      <button class="btn btn-success btn-sm">저장</button>
    	    </div>
    	  `;
    	}
    else if (title === "정책 삭제 암호 설정") {
    	  content.innerHTML = `
    	    <h2>정책 삭제 암호 설정</h2>
    	    <div class="box" style="max-width:400px; margin:auto;">
    	      <form id="deletePwForm">
    	        <div class="mb-3">
    	          <label class="form-label">현재 암호</label>
    	          <input type="password" name="current" class="form-control form-control-sm bg-dark text-white">
    	          <div class="form-text text-muted">현재 설정된 암호를 입력하세요.</div>
    	        </div>
    	        <div class="mb-3">
    	          <label class="form-label">새 암호</label>
    	          <input type="password" name="new" class="form-control form-control-sm bg-dark text-white" required>
    	        </div>
    	        <div class="mb-3">
    	          <label class="form-label">새 암호 확인</label>
    	          <input type="password" name="confirm" class="form-control form-control-sm bg-dark text-white" required>
    	        </div>
    	        <button type="button" class="btn btn-success btn-sm w-100" onclick="saveDeletePassword()">저장</button>
    	      </form>
    	    </div>
    	  `;

    	  // 저장된 암호 여부 표시
    	  const stored = localStorage.getItem("deletePassword");
    	  if (stored) {
    	    document.querySelector("#deletePwForm").insertAdjacentHTML("afterbegin",
    	      `<div class="alert alert-info p-2">현재 설정된 암호: ●●●●●●</div>`);
    	  }
    	}
    else if (title === "시스템 환경 설정") {
    	  content.innerHTML = `
    	    <h2>시스템 환경 설정</h2>
    	    <div class="box mb-3">
    	      <small class="text-muted">Slack 연동, 알림환경 등을 포함한 어플리케이션의 전체 설정입니다.</small>
    	    </div>

    	    <div class="box mb-3" style="max-width:800px;">
    	      <h5>일반</h5>

    	      <div class="mb-2">
    	        <label class="form-label">언어</label>
    	        <select class="form-select bg-dark text-white form-select-sm">
    	          <option>한국어</option>
    	          <option selected>日本語</option>
    	          <option>English</option>
    	        </select>
    	      </div>

    	      <div class="mb-2">
    	        <label class="form-label">테마</label>
    	        <select class="form-select bg-dark text-white form-select-sm">
    	          <option>라이트</option>
    	          <option selected>다크</option>
    	        </select>
    	      </div>

    	      <div class="mb-2">
    	        <label class="form-label">타임존</label>
    	        <select class="form-select bg-dark text-white form-select-sm">
    	          <option>Asia/Seoul</option>
    	          <option selected>America/Los_Angeles</option>
    	          <option>Europe/London</option>
    	        </select>
    	      </div>

    	      <div class="mb-2">
    	        <label class="form-label">날짜 형식</label>
    	        <select class="form-select bg-dark text-white form-select-sm">
    	          <option>DD/MM/YYYY</option>
    	          <option selected>YYYY-MM-DD</option>
    	        </select>
    	      </div>

    	      <div class="mb-2">
    	        <label class="form-label">시간 형식</label>
    	        <select class="form-select bg-dark text-white form-select-sm">
    	          <option>12시간</option>
    	          <option selected>24시간</option>
    	        </select>
    	      </div>

    	      <div class="mb-3">
    	        <label class="form-label">테이블 필드</label>
    	        <select class="form-select bg-dark text-white form-select-sm">
    	          <option selected>컴팩트</option>
    	          <option>넓게</option>
    	        </select>
    	      </div>
    	    </div>
    	    
    	    <div class="text-start" style="max-width:600px;">
    	    <button class="btn btn-success">저장</button>
    	  </div>	 
    	  `;
    	}
    
    // --- 준비중 ---
    else{
      content.innerHTML=`<h2>${title}</h2><p>준비중인 페이지입니다.</p>`;
    }
  } 
  const deletedListModal = document.getElementById("deletedListModal");
  deletedListModal.addEventListener("show.bs.modal", () => {
    const tbody = document.getElementById("deletedPolicyList");
    tbody.innerHTML = "";

    if (deletedPolicies.length === 0) {
      tbody.innerHTML = `<tr><td colspan="5">삭제된 항목이 없습니다.</td></tr>`;
      return;
    }

    deletedPolicies.forEach(p => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${p.rule_id}</td>
        <td>${p.rule_name}</td>
        <td>${p.level}</td>
        <td>${p.rule_type}</td>
        <td>${p.action}</td>
      `;
      tbody.appendChild(row);
    });
  });

  document.addEventListener("DOMContentLoaded", () => {
	  // 첫 페이지 로드 시 '보안 이벤트 요약' 보여주기
	  loadContent('보안 이벤트 요약');

	  // 로그인 경과시간 타이머 시작
	  let seconds = 0;
	  setInterval(() => {
	    seconds++;
	    let m = String(Math.floor(seconds / 60)).padStart(2, '0');
	    let s = String(seconds % 60).padStart(2, '0');
	    const timerEl = document.getElementById("timer");
	    if (timerEl) {
	      timerEl.textContent = `${m}:${s}`;
	    }
	  }, 1000);
	});
  
  function confirmDelete() {
	  const input = document.getElementById("deletePassword").value;
	  const errorBox = document.getElementById("deleteError");
	  const savedPw = localStorage.getItem("deletePassword") || "admin123";
	  if (input === savedPw) {
	    errorBox.style.display = "none";

	    if (rowToDelete) {
	      // 삭제된 정책 데이터를 저장
	      const cells = rowToDelete.querySelectorAll("td");
	      const deletedPolicy = {
	        rule_id: cells[0].innerText,
	        rule_name: cells[1].innerText,
	        level: cells[2].innerText,
	        rule_type: cells[3].innerText,
	        action: cells[4].innerText
	      };
	      deletedPolicies.push(deletedPolicy);

	      rowToDelete.remove(); // ✅ 실제 테이블에서 삭제
	    }

	    const modal = bootstrap.Modal.getInstance(document.getElementById("deleteModal"));
	    modal.hide();
	  } else {
	    errorBox.style.display = "block";
	  }
	}
  
  function togglePacket() {
	  const box = document.getElementById("packetBox");
	  box.style.display = (box.style.display === "none" || box.style.display === "") ? "block" : "none";
	}
  
//백업 실행 (프로그레스 바)
  function runBackup() {
    let progress = 0;
    const bar = document.getElementById("backupProgress");
    const interval = setInterval(() => {
      if (progress >= 100) {
        clearInterval(interval);
        bar.innerText = "완료";
      } else {
        progress += 10;
        bar.style.width = progress + "%";
        bar.innerText = progress + "%";
      }
    }, 300);
  }

  // 백업 스케줄 저장
  function saveSchedule() {
    const selected = document.querySelector("input[name='backupSchedule']:checked");
    const status = document.getElementById("scheduleStatus");
    if (selected) {
      status.innerText = "백업 스케줄: " + selected.value + " 로 저장됨";
    } else {
      status.innerText = "스케줄이 선택되지 않았습니다.";
    }
  }

  // 복구 실행
  function runRestore() {
    const date = document.getElementById("restoreDate").value;
    const db = document.getElementById("restoreDbSelect").value;
    const path = document.getElementById("restorePath").value;

    if (!date || !path) {
      alert("복구 날짜와 경로를 입력하세요.");
      return;
    }

    alert(`📂 [${db}] ${date} 데이터베이스를 ${path} 경로에서 복구 실행!`);
  }
//보호대상 DB 추가 (예시)
  function addDb() {
    alert("DB 추가 기능은 추후 구현 예정입니다.");
  }

  // 수정 버튼
  function editDb(btn) {
    const row = btn.closest("tr");
    const dbName = row.cells[0].innerText;
    alert(dbName + " 수정 기능 실행");
  }

  // 삭제 버튼
  function deleteDb(btn) {
    if (confirm("정말 삭제하시겠습니까?")) {
      btn.closest("tr").remove();
    }
  }
  // 날짜 시간 수정 
  function applyDateTime() {
	  const date = document.getElementById("customDate").value;
	  const time = document.getElementById("customTime").value;

	  if (!date || !time) {
	    alert("날짜와 시간을 모두 선택하세요!");
	    return;
	  }

	  alert(`📅 선택된 날짜/시간: ${date} ${time}`);
	  // 여기서 차트 데이터 다시 불러오기 같은 동작 넣을 수 있음
	}
  function logout() {
	  fetch("/logout", { method: "POST" })
	    .then(() => {
	      window.location.href = "/login";  // 로그아웃 후 로그인 페이지로 이동
	    })
	    .catch(err => console.error("로그아웃 실패:", err));
	}
  
//관리자 계정 관리 - 수정/삭제 버튼 이벤트 위임
document.getElementById("mainContent").addEventListener("click", (e) => {
  // 계정 수정
  if (e.target && e.target.id === "editBtn") {
    const checked = document.querySelectorAll("#accountTable tbody input[type='checkbox']:checked");

    if (checked.length === 0) {
      showAlert("수정할 계정을 선택하세요.");
      return;
    }
    if (checked.length > 1) {
      showAlert("⚠️ 계정 수정은 한 번에 하나만 가능합니다.");
      return;
    }

    const row = checked[0].closest("tr");
    const cells = row.querySelectorAll("td");

    const form = document.getElementById("addAccountForm");
    form.elements["id"].value = cells[1].innerText;
    form.elements["name"].value = cells[2].innerText;
    form.elements["email"].value = cells[3].innerText;
    form.elements["phone"].value = cells[4].innerText;
    form.elements["role"].value = cells[5].innerText;
    form.elements["expire"].value = cells[8].innerText !== "-" ? cells[8].innerText : "";
    form.elements["status"].value = cells[9].innerText.trim();

    form.dataset.editingRow = row.rowIndex;

    const modal = new bootstrap.Modal(document.getElementById("addAccountModal"));
    modal.show();
    
 // 계정 수정 모드일 때
    form.elements["id"].readOnly = true;   // 아이디 고정
    document.getElementById("confirmPwField").style.display = "none"; // 비번 확인버튼추가
    document.getElementById("changePwBox").style.display = "block";
  }
  

  // 계정 삭제
  if (e.target && e.target.id === "deleteBtn") {
    const checked = document.querySelectorAll("#accountTable tbody input[type='checkbox']:checked");

    if (checked.length === 0) {
      showAlert("삭제할 계정을 선택하세요.");
      return;
    }

    showConfirm("선택한 계정을 삭제하시겠습니까?", () => {
      checked.forEach(cb => cb.closest("tr").remove());
    });
  }

  // 상태 뱃지 클릭 시
  if (e.target.classList.contains("status-toggle")) {
    const badge = e.target;
    const current = badge.innerText.trim();
    const next = current === "활성" ? "비활성" : "활성";

    showConfirm(`정말 "${next}" 상태로 변경하시겠습니까?`, () => {
      badge.innerText = next;
      badge.className = `badge badge-lg ${next === "활성" ? "bg-success" : "bg-danger"} status-toggle`;
    });
  }
});

//관리자 계정 관리 - 상태 컬럼 숨기기/보이기
document.getElementById("mainContent").addEventListener("click", (e) => {
  if (e.target && e.target.id === "toggleStatusCol") {
    const table = document.getElementById("accountTable");
    if (!table) return;
    const colIndex = 9; // 상태 컬럼 index (0부터 시작해서 10번째 컬럼)

    const isHidden = table.querySelector("thead th:nth-child(10)").style.display === "none";

    // thead
    table.querySelector("thead th:nth-child(10)").style.display = isHidden ? "" : "none";
    // tbody
    table.querySelectorAll("tbody tr").forEach(tr => {
      tr.cells[colIndex].style.display = isHidden ? "" : "none";
    });

    // 버튼 텍스트 토글
    e.target.innerText = isHidden ? "상태 숨기기" : "상태 보이기";
  }
//"비밀번호 변경" 버튼 클릭 시 → 새 모달 열기
  document.addEventListener("click", (e) => {
    if (e.target && e.target.id === "showPwChange") {
      const modal = new bootstrap.Modal(document.getElementById("changePasswordModal"));
      modal.show();
    }
  });

  // 비밀번호 변경 저장 처리
  document.getElementById("savePwChange").addEventListener("click", () => {
    const form = document.getElementById("changePwForm");
    const data = Object.fromEntries(new FormData(form).entries());

    if (!data.current_password || !data.new_password) {
      showAlert("⚠️ 현재 비밀번호와 새 비밀번호를 입력하세요.");
      return;
    }
    if (data.new_password !== data.new_password_confirm) {
      showAlert("⚠️ 새 비밀번호가 일치하지 않습니다.");
      return;
    }

    // 👉 실제 서버 검증/저장은 여기서 처리
    console.log("비밀번호 변경됨:", data);

    // 모달 닫기 & 초기화
    const modal = bootstrap.Modal.getInstance(document.getElementById("changePasswordModal"));
    modal.hide();
    form.reset();
    showAlert("✅ 비밀번호가 변경되었습니다.");
  });

  function showAlert(msg) {
	  document.getElementById("alertMessage").innerText = msg;
	  new bootstrap.Modal(document.getElementById("alertModal")).show();
	}
//confirm 대체 함수
  function showConfirm(msg, onOk) {
    document.getElementById("confirmMessage").innerText = msg;
    const modalEl = document.getElementById("confirmModal");
    const modal = new bootstrap.Modal(modalEl);
    modal.show();

    // 확인 버튼 클릭 시 콜백 실행
    document.getElementById("confirmOkBtn").onclick = () => {
      modal.hide();
      if (typeof onOk === "function") onOk();
    };
  }
  
  function hideRoleForm() {
	  document.getElementById("roleFormBox").style.display = "none";
	  document.getElementById("roleForm").reset();
	  delete document.getElementById("roleForm").dataset.editingRow;
	}

	function saveRole() {
	  const form = document.getElementById("roleForm");
	  const data = Object.fromEntries(new FormData(form).entries());
	  const tbody = document.querySelector("#roleTable tbody");

	  if (form.dataset.editingRow) {
	    // 수정
	    const row = tbody.rows[form.dataset.editingRow];
	    row.cells[1].innerText = data.name;
	    row.cells[2].innerText = data.level;
	    row.cells[3].innerText = data.desc;
	    delete form.dataset.editingRow;
	  } else {
	    // 신규 등록
	    const row = document.createElement("tr");
	    row.innerHTML = `
	      <td><input type="checkbox"></td>
	      <td>${data.name}</td>
	      <td>${data.level}</td>
	      <td>${data.desc}</td>
	    `;
	    tbody.appendChild(row);
	  }

	  hideRoleForm();
	}
	
	function saveDeletePassword() {
		  const form = document.getElementById("deletePwForm");
		  const currentPw = form.current.value;
		  const newPw = form.new.value;
		  const confirmPw = form.confirm.value;

		  const savedPw = localStorage.getItem("deletePassword") || "admin123";

		  if (currentPw !== savedPw) {
		    alert("⚠️ 현재 암호가 일치하지 않습니다.");
		    return;
		  }
		  if (newPw.length < 8) {
		    alert("⚠️ 새 암호는 8자리 이상이어야 합니다.");
		    return;
		  }
		  if (newPw !== confirmPw) {
		    alert("⚠️ 새 암호와 확인이 일치하지 않습니다.");
		    return;
		  }

		  localStorage.setItem("deletePassword", newPw);
		  alert("✅ 정책 삭제 암호가 변경되었습니다.");
		  form.reset();
		}


	// 사용자 권한 관리 버튼 이벤트 위임
	document.getElementById("mainContent").addEventListener("click", (e) => {
	  // 권한 등록
	  if (e.target && e.target.id === "addRoleBtn") {
	    document.getElementById("roleFormBox").style.display = "block";
	    document.getElementById("roleFormTitle").innerText = "권한 등록";
	  }

	  // 권한 수정
	  if (e.target && e.target.id === "editRoleBtn") {
	    const checked = document.querySelectorAll("#roleTable tbody input[type='checkbox']:checked");
	    if (checked.length === 0) {
	      showAlert("수정할 권한을 선택하세요.");
	      return;
	    }
	    if (checked.length > 1) {
	      showAlert("⚠️ 권한 수정은 한 번에 하나만 가능합니다.");
	      return;
	    }

	    const row = checked[0].closest("tr");
	    const cells = row.querySelectorAll("td");

	    const form = document.getElementById("roleForm");
	    form.elements["name"].value = cells[1].innerText;
	    form.elements["level"].value = cells[2].innerText;
	    form.elements["desc"].value = cells[3].innerText;
	    form.dataset.editingRow = row.rowIndex - 1;

	    document.getElementById("roleFormTitle").innerText = "권한 수정";
	    document.getElementById("roleFormBox").style.display = "block";
	  }

	  // 권한 삭제
	  if (e.target && e.target.id === "deleteRoleBtn") {
	    const checked = document.querySelectorAll("#roleTable tbody input[type='checkbox']:checked");
	    if (checked.length === 0) {
	      showAlert("삭제할 권한을 선택하세요.");
	      return;
	    }
	    if (checked.length > 1) {
	      showAlert("⚠️ 권한 삭제는 한 번에 하나만 가능합니다.");
	      return;
	    }

	    showConfirm("정말 삭제하시겠습니까?", () => {
	      checked[0].closest("tr").remove();
	    });
	  }
	});
	// ===== 시스템 정책 설정 기능 =====
	document.getElementById("mainContent").addEventListener("click", (e) => {
	  // 계정 추가 버튼
	  if (e.target && e.target.id === "addAccountBtn") {
	    const select = document.getElementById("accountSelect");
	    const selected = select.options[select.selectedIndex];
	    if (!selected.value) return;

	    // 이미 추가된 계정인지 확인
	    if (document.querySelector(`#accountTokens span[data-id="${selected.value}"]`)) return;

	    // 토큰 생성
	    const token = document.createElement("span");
	    token.className = "badge bg-info text-dark p-2";
	    token.dataset.id = selected.value;
	    token.dataset.name = selected.dataset.name;
	    token.dataset.phone = selected.dataset.phone;
	    token.dataset.email = selected.dataset.email;
	    token.style.cursor = "pointer";
	    token.innerHTML = `${selected.value} <span class="ms-1 text-danger fw-bold" style="cursor:pointer;">x</span>`;
	    document.getElementById("accountTokens").appendChild(token);
	  }

	  // 토큰 클릭 → 상세 정보
	  if (e.target.closest("span.badge")) {
	    const token = e.target.closest("span.badge");
	    const detailBox = document.getElementById("accountDetailBox");
	    document.getElementById("detailInfo").innerText =
	      `이름 : ${token.dataset.name}\n전화번호 : ${token.dataset.phone}\n이메일 : ${token.dataset.email}`;
	    detailBox.style.display = "block";

	    // 삭제 버튼 (x) 누르면 계정 제거
	    if (e.target.innerText === "x") {
	      token.remove();
	      detailBox.style.display = "none";
	    }
	  }

	  // 상세 정보 박스 닫기
	  if (e.target && e.target.id === "closeDetailBtn") {
	    document.getElementById("accountDetailBox").style.display = "none";
	  }
	});

});

  </script>
</body>
</html>