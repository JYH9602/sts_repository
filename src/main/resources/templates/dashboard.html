<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>CEW 대시보드</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/gh/joungkyun/font-d2coding/d2coding.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  <style>
    body { margin:0; font-family:'D2Coding', monospace; background:#000; color:#ddd; overflow-y:scroll; }

    /* 🚀 빨간 레이저 느낌 스크롤바 */
    ::-webkit-scrollbar { width: 10px; }
    ::-webkit-scrollbar-track { background: #111; }
    ::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #ff0000, #990000);
      border-radius: 5px;
      box-shadow: 0 0 10px #ff0000, 0 0 20px #ff3333;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, #ff3333, #cc0000);
      box-shadow: 0 0 15px #ff0000, 0 0 30px #ff3333;
    }

    .sidebar { position:fixed; top:0; left:0; width:240px; height:100%; background:#000; color:#fff;
      padding:20px 10px; border-right:1px solid #333; overflow-y:auto; }
    .logo-wrapper { text-align:center; margin-bottom:30px; cursor:pointer; }
    .logo-wrapper img { width:140px; }
    .menu { list-style:none; padding:0; margin:0; }
    .menu > li { margin:8px 0; font-size:16px; color:#fff; cursor:pointer; transition:0.3s; }
    .menu > li:hover { color:#ff0000; }
    .toggle { float:right; display:inline-block; width:22px; height:22px; border-radius:50%;
      background:#111; color:#ff0000; font-weight:bold; font-size:14px; text-align:center; line-height:22px;
      margin-left:5px; box-shadow: 0 0 5px #ff0000, 0 0 10px #ff3333; }
    .submenu { list-style:none; padding-left:20px; margin:5px 0; display:none; }
    .submenu li { font-size:14px; margin:4px 0; cursor:pointer; color:#bbb; }
    .submenu li:hover { color:#ff0000; }
    .content { margin-left:260px; padding:80px 20px 20px 20px; }
    .header { background:#000; color:#fff; padding:10px 20px; display:flex;
      justify-content:flex-end; align-items:center; border-bottom:1px solid #333; gap:15px;
      position:fixed; top:0; left:240px; right:0; z-index:1000; }
    #timer, #loginUser { color:#ffff00; }
    #userRole { color:#ffff00; text-shadow:0 0 5px #ffff00, 0 0 10px #ffea00; }
    .btn-danger { background:#ff0000; border:none; }

    /* 공통 박스 */
    .box { border:1px solid #004080; background:#111; padding:10px; color:#ddd; }
    table { width:100%; font-size:12px; border-collapse:collapse; color:#ddd; }
    th,td { border-bottom:1px solid #444; padding:3px; text-align:center; }

    /* 롤링 */
    .rolling-box { border:1px solid #004080; height:30px; overflow:hidden;
      margin:5px 0; font-size:13px; padding:2px 5px; background:#111; }
    .rolling-text { display:flex; flex-direction:column; animation:rollUp 8s linear infinite; }
    @keyframes rollUp { 0%{transform:translateY(0);} 100%{transform:translateY(-100%);} }

    /* 분석 페이지 */
    .dashboard { display:grid; grid-template-rows:60px auto 1fr; grid-gap:8px; min-height:800px; padding:8px; }
    .top-filter { background:#111; border-radius:8px; padding:8px; }
    .charts { display:grid; grid-template-columns:1fr 1fr; grid-gap:8px; align-items:stretch; }
    .tables { display:grid; grid-template-columns:1fr 1fr; grid-gap:8px; }
    .card { background:#111; border:none; border-radius:8px; padding:8px; color:#ddd; }
    .card canvas { width:100% !important; height:auto !important; max-height:none !important; }
    .btn-dark-custom { background:#222; border:none; color:#fff; padding:4px 10px; border-radius:5px; font-size:13px; }
    .btn-dark-custom:hover { background:#444; }
    .table-dark { --bs-table-bg:#161b22; --bs-table-striped-bg:#1c2128; --bs-table-hover-bg:#21262d;
      color:#ddd; font-size:14px; }
    .table-wrapper { max-height:200px; overflow-y:auto; }
    h5 { font-size:14px; margin-bottom:6px; }
    .circle { width:15px; height:15px; border-radius:50%; display:inline-block; margin:0 3px; }
    .green { background:green; } .yellow{background:yellow;} .red{background:red;} .gray{background:gray;}
    .battery { width:100px; height:25px; border:2px solid #fff; position:relative; margin:auto; }
    .battery::after { content:""; position:absolute; right:-6px; top:5px; width:4px; height:15px; background:#fff; }
    .battery-level { height:100%; width:70%; background:limegreen; }
    
    .packet-box {
  		background:#111;
  		color:#0f0;
 		 padding:10px;
 		 font-size:13px;
 		 white-space:pre;
  		border-radius:5px;
  		display:none;
}
	.badge-lg {
  		font-size: 14px;     /* 글자 크기 */
  		padding: 6px 12px;   /* 위아래, 좌우 여백 */
  		border-radius: 6px;  /* 둥글게 */
}

/* 로그아웃된 행 회색 처리 */
	.logged-out {
  		background-color: #444 !important;
  		color: #aaa !important;
}
	.logged-out td, 
	.logged-out th {
  		color: #aaa !important;
}


  </style>
</head>
<body>
  <!-- 사이드바 -->
  <div class="sidebar">
    <div class="logo-wrapper" onclick="loadContent('보안 이벤트 요약')">
      <img src="/images/logo.png" alt="보안 로고" class="logo" id="eagleLogo">
    </div>
    <ul class="menu">
      <li class="has-sub">
        <span class="menu-title">대시보드</span><span class="toggle">+</span>
        <ul class="submenu">
          <li onclick="loadContent('보안 이벤트 요약')">보안 이벤트 요약</li>
          <li onclick="loadContent('보안 이벤트 분석')">보안 이벤트 분석</li>
          <li onclick="loadContent('리소스 사용현황')">리소스 사용현황</li>
        </ul>
      </li>
      <li class="has-sub"><span class="menu-title">정책관리</span><span class="toggle">+</span>
        <ul class="submenu"><li onclick="loadContent('정책 관리 페이지')">정책 관리 페이지</li></ul>
      </li>
      <li class="has-sub"><span class="menu-title">로그센터</span><span class="toggle">+</span>
        <ul class="submenu">
          <li onclick="loadContent('탐지 로그')">탐지 로그</li>
          <li onclick="loadContent('알림 로그')">알림 로그</li>
          <li onclick="loadContent('차단 이력 로그')">차단 이력 로그</li>
          <li onclick="loadContent('관리자 활동 로그')">관리자 활동 로그</li>
        </ul>
      </li>
      <li class="has-sub"><span class="menu-title">DB 관리서버</span><span class="toggle">+</span>
        <ul class="submenu">
          <li onclick="loadContent('백업 & 복구')">백업 & 복구</li>
          <li onclick="loadContent('보호대상 DB 관리')">보호대상 DB 관리</li>
        </ul>
      </li>
      <li class="has-sub"><span class="menu-title">관리자 페이지</span><span class="toggle">+</span>
        <ul class="submenu">
          <li onclick="loadContent('관리자 계정 관리')">관리자 계정 관리</li>
          <li onclick="loadContent('사용자 권한 관리')">사용자 권한 관리</li>
          <li onclick="loadContent('시스템 정책 설정')">시스템 정책 설정</li>
        </ul>
      </li>
      <li onclick="loadContent('시스템 환경 설정')">시스템 환경 설정</li>
    </ul>
  </div>

<!-- 헤더 -->
<div class="header">
  <span>로그인 경과시간: <strong id="timer">00:00</strong></span>
  <span>로그인 아이디: <strong id="loginUser" th:text="${user.login_id}"></strong></span>
  <span>권한: <strong id="userRole" th:text="${user.position}"></strong></span>
  <button class="btn btn-danger btn-sm" onclick="location.href='/logout'">로그아웃</button>
</div>

  <!-- 메인 -->
 <div class="content" id="mainContent"></div>


  <!-- 정책 편집 모달 -->
<div class="modal fade" id="policyModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title">정책 편집 (신규)</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        
        <!-- 기본 -->
        <div class="card mb-3 bg-secondary bg-opacity-25 p-3">
          <h6>기본</h6>
          <div class="row g-2">
            <div class="col-md-4"><label class="form-label">rule_id</label><input type="text" class="form-control form-control-sm bg-dark text-white" value="CEW_BLOCK01"></div>
            <div class="col-md-4"><label class="form-label">rule_name</label><input type="text" class="form-control form-control-sm bg-dark text-white" value="도둑잡기"></div>
            <div class="col-md-2"><label class="form-label">priority</label><input type="number" class="form-control form-control-sm bg-dark text-white" value="1"></div>
            <div class="col-md-2"><label class="form-label">action</label>
              <select class="form-select form-select-sm bg-dark text-white"><option>block</option><option>pass</option></select>
            </div>
            <div class="col-md-3"><label class="form-label">level</label>
              <select class="form-select form-select-sm bg-dark text-white"><option>safe</option><option>danger</option></select>
            </div>
            <div class="col-md-3"><label class="form-label">rule_type</label>
              <select class="form-select form-select-sm bg-dark text-white"><option>pattern</option><option>behavior</option></select>
            </div>
          </div>
        </div>

        <!-- 대상 / 조건 -->
        <div class="card mb-3 bg-secondary bg-opacity-25 p-3">
          <h6>대상 / 조건</h6>
          <div class="row g-2">
            <div class="col-md-3"><label class="form-label">ip_start</label><input type="text" class="form-control form-control-sm bg-dark text-white" value="192.168.1.10"></div>
            <div class="col-md-3"><label class="form-label">ip_end</label><input type="text" class="form-control form-control-sm bg-dark text-white" value="192.168.1.20"></div>
            <div class="col-md-3"><label class="form-label">port_start</label><input type="number" class="form-control form-control-sm bg-dark text-white" value="22"></div>
            <div class="col-md-3"><label class="form-label">port_end</label><input type="number" class="form-control form-control-sm bg-dark text-white" value="30"></div>
            <div class="col-md-4"><label class="form-label">block_duration (sec)</label><input type="number" class="form-control form-control-sm bg-dark text-white" value="0"></div>
            <div class="col-md-4"><label class="form-label">base_cnt</label><input type="number" class="form-control form-control-sm bg-dark text-white" value="0"></div>
          </div>
        </div>

        <!-- 스케줄 -->
        <div class="card mb-3 bg-secondary bg-opacity-25 p-3">
          <h6>스케줄</h6>
          <div class="row g-2">
            <div class="col-md-4"><label class="form-label">effective_from</label><input type="time" class="form-control form-control-sm bg-dark text-white"></div>
            <div class="col-md-4"><label class="form-label">effective_to</label><input type="time" class="form-control form-control-sm bg-dark text-white"></div>
            <div class="col-md-4"><label class="form-label">expire_dt</label><input type="date" class="form-control form-control-sm bg-dark text-white"></div>
            <div class="col-md-4"><label class="form-label">created_by</label><input type="text" class="form-control form-control-sm bg-dark text-white" value="admin" readonly></div>
            <div class="col-md-4"><label class="form-label">updated_by</label><input type="text" class="form-control form-control-sm bg-dark text-white" value="admin" readonly></div>
          </div>
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">닫기</button>
        <button type="button" class="btn btn-primary btn-sm">저장</button>
      </div>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" defer></script>
<!-- 삭제 확인 모달 -->
<div class="modal fade" id="deleteModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title">삭제 확인</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p>정책을 삭제하려면 암호를 입력하세요.</p>
        <input type="password" id="deletePassword" class="form-control form-control-sm bg-dark text-white" placeholder="삭제 암호 입력">
        <div id="deleteError" class="text-danger mt-2" style="display:none;">암호가 올바르지 않습니다.</div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal">취소</button>
        <button class="btn btn-danger btn-sm" onclick="confirmDelete()">삭제</button>
      </div>
    </div>
  </div>
</div>
<!-- 삭제된 항목 보기 모달 -->
<div class="modal fade" id="deletedListModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title">삭제된 정책 목록</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <table class="table table-dark table-striped text-center">
          <thead>
            <tr>
              <th>rule_id</th>
              <th>rule_name</th>
              <th>level</th>
              <th>rule_type</th>
              <th>action</th>
            </tr>
          </thead>
          <tbody id="deletedPolicyList">
            <tr><td colspan="5">삭제된 항목이 없습니다.</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- 탐지로그 상세 모달 -->
<div class="modal fade" id="logDetailModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title">상세 정보</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <h6>요약 정보</h6>
        <ul>
          <li>시간: 2025-09-16 10:00</li>
          <li>정책명: SQL Injection</li>
          <li>위험도: <span class="badge bg-danger">High</span></li>
          <li>탐지 유형: Web Attack</li>
          <li>출발지 IP: 192.168.1.10</li>
          <li>목적지 IP: 10.0.0.5</li>
        </ul>

        <h6 class="mt-3">패킷 해석 내용</h6>
        <p><strong>HTTP 요청:</strong> GET /login.php?id=1' OR '1'='1 HTTP/1.1</p>
        <p><strong>Host:</strong> victim.com</p>
        <p><strong>User-Agent:</strong> Mozilla/5.0 …</p>

        <button class="btn btn-secondary btn-sm mt-2" onclick="togglePacket()">원본 패킷 보기</button>
        <div id="packetBox" class="packet-box mt-2">
4500 003c 1c46 4000 4006 b1e6 c0a8 0001
c0a8 0067 0050 89ab 1190 0000 0000 0000
5018 ffff aaaa bbbb 4745 5420 2f6c 6f67
696e 2e70 6870 3f69 643d 3127 204f 5220
3127 3d31 2048 5454 502f 312e 31
        </div>
      </div>
    </div>
  </div>
</div>
<!-- 알림로그 상세 모달 -->
<div class="modal fade" id="alertLogModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title">알림 로그 상세</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <h6>요약 정보</h6>
        <ul>
          <li>알림 시각: 2025-09-16 09:50</li>
          <li>알림 대상자: admin01 (admin@test.com)</li>
          <li>알림 방식: Email</li>
          <li>알림 등급: 긴급</li>
          <li>관련 탐지 이벤트 ID: DET-00123</li>
          <li>알림 내용: 고위험 SQL Injection 탐지됨</li>
          <li>발송 상태: 성공</li>
        </ul>

        <button class="btn btn-secondary btn-sm mt-2" onclick="togglePacket()">원본 패킷 보기</button>
        <div id="packetBox" class="packet-box mt-2">
알림 로그는 패킷 데이터가 없을 수도 있습니다.
        </div>
      </div>
    </div>
  </div>
</div>
<!-- 차단 이력 로그 상세 모달 -->
<div class="modal fade" id="blockLogModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title">차단 이력 로그 상세</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <h6>요약 정보</h6>
        <ul>
          <li>차단 시각: 2025-09-15 14:30</li>
          <li>정책명/룰 ID: Port Scan Rule #12</li>
          <li>차단 대상: 203.0.113.77</li>
          <li>출발지: 203.0.113.77:55555</li>
          <li>목적지: 10.0.0.7:22</li>
          <li>차단 사유: 비인가 포트 접근</li>
          <li>차단 결과: <span class="badge bg-success badge-lg">성공</span></li>
          <li>차단 지속시간: 10분</li>
        </ul>
      </div>
    </div>
  </div>
</div>
<script>
  // 메뉴 토글
  document.querySelectorAll(".has-sub").forEach(menu=>{
    const toggle=menu.querySelector(".toggle");
    const title=menu.querySelector(".menu-title");
    const submenu=menu.querySelector(".submenu");
    function toggleMenu(e){ e.stopPropagation();
      submenu.style.display=(submenu.style.display==="block")?"none":"block";
      toggle.textContent=(submenu.style.display==="block")?"-":"+"; }
    toggle.addEventListener("click",toggleMenu);
    title.addEventListener("click",toggleMenu);
  });
  let rowToDelete = null;  // 전역 변수
  let deletedPolicies = []; // 삭제된 정책들을 보관

  function openDeleteModal(btn) {
    rowToDelete = btn.closest("tr");
    const modal = new bootstrap.Modal(document.getElementById("deleteModal"));
    modal.show();
  }

  function loadContent(title) {
    const content = document.getElementById("mainContent");
    // --- 보안 이벤트 요약 ---
    if(title==="보안 이벤트 요약"){
      content.innerHTML=`
        <h2>보안 이벤트 요약</h2>
        <div>실시간 탐지 내용:</div>
        <div class="rolling-box"><div class="rolling-text">
          <span>[탐지] SQL Injection 차단됨</span>
          <span>[탐지] XSS 공격 탐지됨</span>
          <span>[탐지] Port Scan 발생</span>
          <span>[탐지] RDP Brute Force 차단</span>
        </div></div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:15px;">
          <div class="box"><canvas id="chart1"></canvas></div>
          <div class="box"><canvas id="chart2"></canvas></div>
        </div>
        <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-top:15px;">
          <div class="box">일일 탐지 순위 (정책기반)</div>
          <div class="box"><canvas id="chart3"></canvas></div>
          <div class="box">일일 누적 탐지 패킷수</div>
        </div>
        <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-top:15px;">
          <div class="box">서버상태<br>
            <span class="circle green"></span>
            <span class="circle yellow"></span>
            <span class="circle red"></span>
            <span class="circle gray"></span>
          </div>
          <div class="box">리소스 사용량<br>
            <div class="battery"><div class="battery-level"></div></div>
          </div>
          <div class="box">방화벽 상태<br><strong style="color:lime;">ON</strong></div>
          <div class="box">열려 있는 포트
            <table><tr><th>포트</th><th>상태</th></tr>
              <tr><td>22</td><td>Open</td></tr>
              <tr><td>80</td><td>Open</td></tr>
              <tr><td>443</td><td>Open</td></tr>
            </table>
          </div>
          <div class="box">최근접속로그
            <table><tr><th>시간</th><th>IP</th></tr>
              <tr><td>12:00</td><td>192.168.0.10</td></tr>
              <tr><td>12:05</td><td>192.168.0.11</td></tr>
            </table>
          </div>
          <div class="box">일일 이메일 알림현황
            <ul>
              <li>관리자 알림 전송 완료</li>
              <li>정책 알림 대기</li>
              <li>서버상태 알림 완료</li>
            </ul>
          </div>
        </div>`;
      new Chart(document.getElementById('chart1'),{type:'line',
        data:{labels:["0시","4시","8시","12시","16시","20시"],
          datasets:[{label:"행동기반",data:[5,7,3,8,6,9],borderColor:"red",fill:false},
                    {label:"패턴기반",data:[3,4,6,2,7,5],borderColor:"blue",fill:false}]}}); 
      new Chart(document.getElementById('chart2'),{type:'bar',
        data:{labels:["정책A","정책B","정책C"],
          datasets:[{label:"탐지 건수",data:[12,19,7],backgroundColor:["red","orange","green"]}]}}); 
      new Chart(document.getElementById('chart3'),{type:'pie',
        data:{labels:["Critical","High","Medium","Low"],
          datasets:[{data:[5,10,15,20],backgroundColor:["red","orange","yellow","green"]}]}}); 
    }

    // --- 보안 이벤트 분석 ---
    else if(title==="보안 이벤트 분석"){
      content.innerHTML=`
        <div class="dashboard">
          <div class="top-filter">
            <div class="row g-2">
              <div class="col-md-2"><select class="form-select bg-dark text-white form-select-sm">
                <option>행동기반</option><option>패턴기반</option><option>정책기반</option></select></div>
              <div class="col-md-3"><input type="date" class="form-control bg-dark text-white form-control-sm"></div>
              <div class="col-md-3"><input type="time" class="form-control bg-dark text-white form-control-sm"></div>
              <div class="col-md-2 ms-auto text-end">
                <button class="btn-dark-custom btn-sm me-2">적용</button>
                <button class="btn-dark-custom btn-sm">초기화</button>
              </div>
            </div>
          </div>
          <div class="charts">
            <div class="card"><h5>시간대별 탐지</h5><canvas id="timeChart"></canvas></div>
            <div class="d-flex flex-column gap-2">
              <div class="card flex-fill"><h5>탐지 TOP 10</h5><canvas id="top10Chart"></canvas></div>
              <div class="card flex-fill"><h5>위험도 분포</h5><canvas id="riskChart"></canvas></div>
              <div class="card flex-fill"><h5>탐지유형 비율</h5><canvas id="typeChart"></canvas></div>
            </div>
          </div>
          <div class="tables">
            <div class="card"><h5>시간대별 탐지 로그</h5>
              <div class="table-wrapper">
                <table class="table table-dark table-striped">
                  <thead><tr><th>시간</th><th>정책</th><th>위험도</th><th>출발지</th><th>조치</th></tr></thead>
                  <tbody>
                    <tr><td>2025-09-13 11:50</td><td>SQL Injection</td><td>Critical</td><td>203.0.113.10</td><td>차단</td></tr>
                    <tr><td>2025-09-13 11:45</td><td>Brute Force</td><td>High</td><td>198.51.100.5</td><td>차단</td></tr>
                    <tr><td>2025-09-13 11:40</td><td>Port Scan</td><td>Medium</td><td>192.168.1.100</td><td>탐지만</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="card"><h5>위험도 분포 (목록)</h5>
              <div class="table-wrapper">
                <table class="table table-dark">
                  <thead><tr><th>위험도</th><th>건수</th></tr></thead>
                  <tbody>
                    <tr><td>Critical</td><td>11</td></tr>
                    <tr><td>High</td><td>71</td></tr>
                    <tr><td>Medium</td><td>87</td></tr>
                    <tr><td>Low</td><td>101</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>`;
      new Chart(document.getElementById('timeChart'),{type:'line',
        data:{labels:['00시','03시','06시','09시','12시'],
          datasets:[{label:'탐지 건수',data:[3,7,5,12,9],borderColor:'red',fill:false}]}}); 
      new Chart(document.getElementById('top10Chart'),{type:'bar',
        data:{labels:['SQL Injection','Brute Force','Port Scan','XSS'],
          datasets:[{label:'탐지 건수',data:[20,15,8,5],backgroundColor:['#ff4d4d','#ff9933','#3399ff','#ffcc00']}]}}); 
      new Chart(document.getElementById('riskChart'),{type:'doughnut',
        data:{labels:['Critical','High','Medium','Low'],
          datasets:[{data:[11,71,87,101],backgroundColor:['#ff4d4d','#ff9933','#ffcc00','#3399ff']}]}}); 
      new Chart(document.getElementById('typeChart'),{type:'pie',
        data:{labels:['SQL Injection','XSS','Brute Force','Port Scan'],
          datasets:[{data:[25,15,20,10],backgroundColor:['#e74c3c','#9b59b6','#2980b9','#27ae60']}]}}); 
    }

    // --- 리소스 사용현황 ---
    else if(title==="리소스 사용현황"){
      content.innerHTML=`
        <h2>리소스 사용현황</h2>
        <div style="display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-bottom:15px;">
          <div class="box text-center"><h5>CPU</h5><div id="cpuUsage" style="font-size:20px;">0%</div></div>
          <div class="box text-center"><h5>메모리</h5><div id="memoryUsage" style="font-size:20px;">0%</div></div>
          <div class="box text-center"><h5>스토리지</h5><div id="storageUsage" style="font-size:20px;">0%</div></div>
          <div class="box text-center"><h5>네트워크</h5><div id="networkUsage" style="font-size:20px;">0 Mbps</div></div>
        </div>
        <div style="display:grid; grid-template-columns:2fr 1fr; gap:10px; margin-bottom:15px;">
          <div class="box"><h5>리소스 트렌드</h5><canvas id="resourceTrend"></canvas></div>
          <div class="box"><h5>알림 & 상태</h5>
            <ul style="font-size:13px; list-style:none; padding-left:0;">
              <li>09:10 - 스토리지 사용률 80% 근접 (경고)</li>
              <li>04:25 - CPU 스파이크 감지</li>
              <li>어제 22:11 - 네트워크 RX 비정상</li>
            </ul>
            <button class="btn-dark-custom btn-sm mt-2">임계치 초과시 이메일 알림</button>
            <button class="btn-dark-custom btn-sm mt-2">자동 정책 · 스로틀링</button>
          </div>
        </div>
        <div class="box"><h5>상세정보</h5><p>메모리, 스토리지, 네트워크 (향후 개발 예정)</p></div>`;
      new Chart(document.getElementById('resourceTrend'),{type:'line',
        data:{labels:Array.from({length:12},(_,i)=>(i*5)+":00"),
          datasets:[
            {label:"CPU(%)",data:[20,40,35,60,45,70,55,65,40,50,45,60],borderColor:"red",fill:false},
            {label:"메모리(%)",data:[30,35,40,45,50,55,60,62,58,57,59,60],borderColor:"orange",fill:false},
            {label:"네트워크(Mbps)",data:[100,150,120,200,180,220,210,190,170,160,180,200],borderColor:"blue",fill:false},
            {label:"스토리지(%)",data:[50,52,53,54,55,56,57,58,59,60,61,62],borderColor:"green",fill:false}
          ]}}); 
      setInterval(()=>{document.getElementById("cpuUsage").innerText=Math.floor(Math.random()*100)+"%";
        document.getElementById("memoryUsage").innerText=Math.floor(Math.random()*100)+"%";
        document.getElementById("storageUsage").innerText=(40+Math.floor(Math.random()*60))+"%";
        document.getElementById("networkUsage").innerText=(100+Math.floor(Math.random()*900))+" Mbps";},3000);
    }
    // --- 정책 관리 페이지 ---
    else if(title==="정책 관리 페이지"){
      content.innerHTML = `
        <h2>정책 관리</h2>
        <div class="box mb-3">
          <div class="row g-2">
            <div class="col-md-2"><input type="text" class="form-control form-control-sm bg-dark text-white" placeholder="rule_id, rule_name"></div>
            <div class="col-md-1"><select class="form-select form-select-sm bg-dark text-white"><option>전체</option><option>패턴기반</option></select></div>
            <div class="col-md-1"><select class="form-select form-select-sm bg-dark text-white"><option>전체</option><option>pass</option><option>block</option></select></div>
            <div class="col-md-1"><select class="form-select form-select-sm bg-dark text-white"><option>전체</option><option>safe</option><option>danger</option></select></div>
            <div class="col-md-1"><select class="form-select form-select-sm bg-dark text-white"><option>전체</option><option>enable</option><option>disable</option></select></div>
            <div class="col-md-1"><input type="number" class="form-control form-control-sm bg-dark text-white" value="0"></div>
            <div class="col-md-2"><input type="date" class="form-control form-control-sm bg-dark text-white"></div>
            <div class="col-md-2"><input type="date" class="form-control form-control-sm bg-dark text-white"></div>
            <div class="col-md-2">
            <div class="text">
            <button class="btn btn-primary btn-sm">필터 적용</button>
            <button class="btn btn-secondary btn-sm">초기화</button>
          </div>
          </div>
          </div>
        </div>

        <div class="d-flex justify-content-end mb-2 gap-2">
          <button class="btn btn-success btn-sm">CSV 내보내기</button>
          <button class="btn btn-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#deletedListModal">삭제된 항목 보기</button>
          <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#policyModal">신규 정책</button>
        </div>

        <div class="table-wrapper">
          <table class="table table-dark table-striped text-center">
            <thead>
              <tr>
                <th>rule_id</th>
                <th>rule_name</th>
                <th>level</th>
                <th>rule_type</th>
                <th>action</th>
                <th>IP Range</th>
                <th>Port Range</th>
                <th>enable</th>
                <th>priority</th>
                <th>effective</th>
                <th>expire_dt</th>
                <th>작업</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>CEW_PASS01</td>
                <td>내부허용</td>
                <td><span class="badge bg-success badge-lg">safe</span></td>
                <td>pattern</td>
                <td>pass</td>
                <td>10.0.0.1 ~ 10.0.0.255</td>
                <td>80 ~ 80</td>
                <td><input type="checkbox" checked></td>
                <td>5</td>
                <td>00:00 ~ 23:59</td>
                <td>9999-12-30 00:00</td>
                <td>
                  <button class="btn-dark-custom btn-sm">수정</button>
                  <button class="btn-dark-custom btn-sm">이력</button>
                  <button class="btn-dark-custom btn-sm" onclick="openDeleteModal(this)">삭제</button>
                </td>
              </tr>
              <tr>
                <td>CEW_BLOCK02</td>
                <td>SQL Injection 차단</td>
                <td><span class="badge bg-danger badge-lg">danger</span></td>
                <td>pattern</td>
                <td>block</td>
                <td>*</td>
                <td>*</td>
                <td><input type="checkbox"></td>
                <td>2</td>
                <td>00:00 ~ 23:59</td>
                <td>9999-12-30 00:00</td>
                <td>
                  <button class="btn-dark-custom btn-sm">수정</button>
                  <button class="btn-dark-custom btn-sm">이력</button>
                  <button class="btn-dark-custom btn-sm" onclick="openDeleteModal(this)">삭제</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      `;
    }
    // ====== 탐지로그 =======
    else if(title === "탐지 로그") {
    	  content.innerHTML = `
    	    <h2>탐지 로그</h2>
    	    <table class="table table-dark table-bordered text-center">
    	      <thead>
    	        <tr>
    	          <th>탐지 시각</th>
    	          <th>정책명/탐지규칙</th>
    	          <th>위험도</th>
    	          <th>탐지 유형</th>
    	          <th>출발지 IP</th>
    	          <th>출발지 Port</th>
    	          <th>목적지 IP</th>
    	          <th>목적지 Port</th>
    	          <th>작업</th>
    	        </tr>
    	      </thead>
    	      <tbody>
    	        <tr>
    	          <td>2025-09-16 10:00</td>
    	          <td>SQL Injection</td>
    	          <td><span class="badge bg-danger badge-lg">High</span></td>
    	          <td>Web Attack</td>
    	          <td>192.168.1.10</td>
    	          <td>12345</td>
    	          <td>10.0.0.5</td>
    	          <td>80</td>
    	          <td>
    	            <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#logDetailModal">
    	              상세
    	            </button>
    	          </td>
    	        </tr>
    	      </tbody>
    	    </table>
    	  `;
    	}
 // ====== 알림 로그 ======
    else if(title === "알림 로그") {
      content.innerHTML = `
        <h2>알림 로그</h2>
        <div class="table-wrapper">
          <table class="table table-dark table-bordered text-center">
            <thead>
              <tr>
                <th>알림 시각</th>
                <th>알림 대상자</th>
                <th>알림 방식</th>
                <th>알림 등급</th>
                <th>관련 탐지 이벤트 ID</th>
                <th>알림 내용</th>
                <th>발송 상태</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>2025-09-16 09:50</td>
                <td>admin01<br>(admin@test.com)</td>
                <td>Email</td>
                <td><span class="badge bg-danger badge-lg">긴급</span></td>
                <td>DET-00123</td>
                <td>고위험 SQL Injection 탐지됨</td>
                <td><span class="badge bg-success badge-lg">성공</span></td>
              </tr>
            </tbody>
          </table>
        </div>
      `;
    }
 // ====== 차단 이력 로그 ======
    else if(title === "차단 이력 로그") {
      content.innerHTML = `
        <h2>차단 이력 로그</h2>
        <div class="table-wrapper">
          <table class="table table-dark table-bordered text-center">
            <thead>
              <tr>
                <th>차단 시각</th>
                <th>정책명/룰 ID</th>
                <th>차단 대상</th>
                <th>출발지 IP</th>
                <th>출발지 Port</th>
                <th>목적지 IP</th>
                <th>목적지 Port</th>
                <th>차단 사유</th>
                <th>차단 결과</th>
                <th>차단 지속시간</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>2025-09-15 14:30</td>
                <td>Port Scan Rule #12</td>
                <td>203.0.113.77</td>
                <td>203.0.113.77</td>
                <td>55555</td>
                <td>10.0.0.7</td>
                <td>22</td>
                <td>비인가 포트 접근</td>
                <td><span class="badge bg-success badge-lg">성공</span></td>
                <td>10분</td>
              </tr>
            </tbody>
          </table>
        </div>
      `;
    }
 // ====== 관리자 활동 로그 ======
    else if(title === "관리자 활동 로그") {
      content.innerHTML = `
        <h2>관리자 활동 로그</h2>
        <div class="table-wrapper">
          <table class="table table-dark table-bordered text-center">
            <thead>
              <tr>
                <th>활동 시각</th>
                <th>관리자 ID</th>
                <th>관리자 계정</th>
                <th>사용페이지</th>
                <th>세부 활동 내용</th>
                <th>접속 IP</th>
                <th>결과 상태</th>
                <th>비고</th>
              </tr>
            </thead>
            <tbody>
            <!-- 정상 활동 -->
            <tr>
              <td>2025-09-15 11:00</td>
              <td>admin01</td>
              <td>관리자 계정 A</td> <!-- 추가 -->
              <td>정책관리</td>
              <td>SQL Injection 차단 정책 수정</td>
              <td>192.168.1.100</td>
              <td><span class="badge bg-success badge-lg">로그인</span></td>
              <td>-</td>
            </tr>

            <!-- 로그아웃된 계정 -->
            <tr class="logged-out">
              <td>2025-09-15 11:05</td>
              <td>admin02</td>
              <td>관리자 계정 B</td> <!-- 추가 -->
              <td>시스템환경설정</td>
              <td>로그아웃</td>
              <td>192.168.1.110</td>
              <td><span class="badge bg-secondary badge-lg">로그오프</span></td>
              <td>-</td>
            </tr>
          </tbody>
          </table>
        </div>
      `;
    }
 // --- 백업 & 복구 ---
    else if (title === "백업 & 복구") {
      content.innerHTML = `
        <h2>DB 백업 & 복구</h2>

        <!-- 백업 설정 -->
        <div class="box mb-3">
          <h5>백업 설정</h5>
          <div class="mb-2">
            <label class="form-label">DB 선택</label>
            <select class="form-select bg-dark text-white form-select-sm" id="dbSelect">
              <option>MySQL</option>
              <option>PostgreSQL</option>
              <option>MariaDB</option>
            </select>
          </div>
          <div class="mb-2">
            <label class="form-label">백업 경로</label>
            <input type="text" id="backupPath" class="form-control bg-dark text-white" value="/backup/db/">
          </div>
          <button class="btn btn-primary btn-sm" onclick="runBackup()">백업 실행</button>
          <div class="progress mt-2" style="height:20px;">
            <div id="backupProgress" class="progress-bar bg-success" role="progressbar" style="width:0%;">0%</div>
          </div>
        </div>

        <!-- 백업 스케줄 설정 -->
        <div class="box mb-3">
          <h5>백업 스케줄 설정</h5>
          <div class="mb-2">
            <input type="radio" name="backupSchedule" value="daily"> 매일
            <input type="radio" name="backupSchedule" value="weekly"> 매주
            <input type="radio" name="backupSchedule" value="monthly"> 매월
          </div>
          <button class="btn btn-secondary btn-sm" onclick="saveSchedule()">저장</button>
          <p id="scheduleStatus" class="mt-2 text-info">백업 스케줄: 미설정</p>
        </div>

        <!-- 복구 실행 -->
        <div class="box">
          <h5>복구 실행</h5>
          <div class="mb-2">
            <label class="form-label">복구 날짜</label>
            <input type="date" id="restoreDate" class="form-control bg-dark text-white">
          </div>
          <button class="btn btn-info btn-sm" onclick="runRestore()">복구</button>
          <div class="mt-2">
            <label class="form-label">DB 선택</label>
            <select class="form-select bg-dark text-white form-select-sm" id="restoreDbSelect">
              <option>MySQL</option>
              <option>PostgreSQL</option>
              <option>MariaDB</option>
            </select>
          </div>
          <div class="mt-2">
            <label class="form-label">복구 경로</label>
            <input type="text" id="restorePath" class="form-control bg-dark text-white" placeholder="/backup/db/yyyy-mm-dd/">
          </div>
        </div>
      `;
    }
    
    


    // --- 준비중 ---
    else{
      content.innerHTML=`<h2>${title}</h2><p>준비중인 페이지입니다.</p>`;
    }
  } 
  const deletedListModal = document.getElementById("deletedListModal");
  deletedListModal.addEventListener("show.bs.modal", () => {
    const tbody = document.getElementById("deletedPolicyList");
    tbody.innerHTML = "";

    if (deletedPolicies.length === 0) {
      tbody.innerHTML = `<tr><td colspan="5">삭제된 항목이 없습니다.</td></tr>`;
      return;
    }

    deletedPolicies.forEach(p => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${p.rule_id}</td>
        <td>${p.rule_name}</td>
        <td>${p.level}</td>
        <td>${p.rule_type}</td>
        <td>${p.action}</td>
      `;
      tbody.appendChild(row);
    });
  });

  function logout(){window.location.href="index.html";}

  document.addEventListener("DOMContentLoaded", () => {
	  // 첫 페이지 로드 시 '보안 이벤트 요약' 보여주기
	  loadContent('보안 이벤트 요약');

	  // 로그인 경과시간 타이머 시작
	  let seconds = 0;
	  setInterval(() => {
	    seconds++;
	    let m = String(Math.floor(seconds / 60)).padStart(2, '0');
	    let s = String(seconds % 60).padStart(2, '0');
	    const timerEl = document.getElementById("timer");
	    if (timerEl) {
	      timerEl.textContent = `${m}:${s}`;
	    }
	  }, 1000);
	});
  
  function confirmDelete() {
	  const input = document.getElementById("deletePassword").value;
	  const errorBox = document.getElementById("deleteError");

	  if (input === "admin123") {
	    errorBox.style.display = "none";

	    if (rowToDelete) {
	      // 삭제된 정책 데이터를 저장
	      const cells = rowToDelete.querySelectorAll("td");
	      const deletedPolicy = {
	        rule_id: cells[0].innerText,
	        rule_name: cells[1].innerText,
	        level: cells[2].innerText,
	        rule_type: cells[3].innerText,
	        action: cells[4].innerText
	      };
	      deletedPolicies.push(deletedPolicy);

	      rowToDelete.remove(); // ✅ 실제 테이블에서 삭제
	    }

	    const modal = bootstrap.Modal.getInstance(document.getElementById("deleteModal"));
	    modal.hide();
	  } else {
	    errorBox.style.display = "block";
	  }
	}
  
  function togglePacket() {
	  const box = document.getElementById("packetBox");
	  box.style.display = (box.style.display === "none" || box.style.display === "") ? "block" : "none";
	}
  
//백업 실행 (프로그레스 바)
  function runBackup() {
    let progress = 0;
    const bar = document.getElementById("backupProgress");
    const interval = setInterval(() => {
      if (progress >= 100) {
        clearInterval(interval);
        bar.innerText = "완료";
      } else {
        progress += 10;
        bar.style.width = progress + "%";
        bar.innerText = progress + "%";
      }
    }, 300);
  }

  // 백업 스케줄 저장
  function saveSchedule() {
    const selected = document.querySelector("input[name='backupSchedule']:checked");
    const status = document.getElementById("scheduleStatus");
    if (selected) {
      status.innerText = "백업 스케줄: " + selected.value + " 로 저장됨";
    } else {
      status.innerText = "스케줄이 선택되지 않았습니다.";
    }
  }

  // 복구 실행
  function runRestore() {
    const date = document.getElementById("restoreDate").value;
    const db = document.getElementById("restoreDbSelect").value;
    const path = document.getElementById("restorePath").value;

    if (!date || !path) {
      alert("복구 날짜와 경로를 입력하세요.");
      return;
    }

    alert(`📂 [${db}] ${date} 데이터베이스를 ${path} 경로에서 복구 실행!`);
  }

  
  </script>
</body>
</html>